"use strict";(self.webpackChunkrims_frontend=self.webpackChunkrims_frontend||[]).push([[213],{213:function(t,e,n){n.r(e),n.d(e,{Main:function(){return f}});var i=n(942),a=n(413),s=n(671),r=n(144),o=n(340),u=n(882),l=n(791),d=n(252),c=n(885),h=n(698),p=n(682),m=n(184),f=function(t){(0,o.Z)(n,t);var e=(0,u.Z)(n);function n(t){var i;return(0,s.Z)(this,n),(i=e.call(this,t)).reloadList=function(){return(0,d.Fh)("api/multimedia/list",{},{"X-Route":i.node}).then((function(t){return i.setState(t)}))},i.deleteList=function(t){return window.confirm("Delete file "+t.file+"?")&&(0,d.Fh)("api/multimedia/delete",t,{"X-Route":i.node}).then((function(e){e.deleted&&(i.setState({data:i.state.data.filter((function(e){return!(e.path===t.path&&e.file===t.file)}))}),i.changeContent(null))}))},i.listItem=function(t,e){return[t.file,(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(p.InfoButton,{onClick:function(){return i.changeContent((0,m.jsx)(x,{path:t.path,file:t.file,node:i.node},"multimedia_title_"+e))},title:"Title info"},"info"),(0,m.jsx)(p.SearchButton,{onClick:function(){return i.changeContent((0,m.jsx)(_,{path:t.path,file:t.file,node:i.node},"multimedia_lookup_"+e))},title:"Lookup info"},"lookup"),(0,m.jsx)(p.DocButton,{onClick:function(){return i.changeContent((0,m.jsx)(j,{path:t.path,file:t.file,node:i.node},"multimedia_subs_"+e))},title:"Subtitles"},"subs"),(0,m.jsx)(p.DeleteButton,{onClick:function(){return i.deleteList(t)},title:"Delete file"},"del")]})]},i.state={},i.node=i.props.node?i.props.node:i.context.settings.node,i}return(0,r.Z)(n,[{key:"componentDidMount",value:function(){this.reloadList()}},{key:"componentDidUpdate",value:function(t){t!==this.props&&(this.node=this.props.node?this.props.node:this.context.settings.node)}},{key:"render",value:function(){var t=this;return this.state.data?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(c.ContentList,{header:"Media files",thead:["File",""],trows:this.state.data,listItem:this.listItem,result:this.state.result,children:[(0,m.jsx)(p.ReloadButton,{onClick:function(){return t.reloadList()}},"reload"),(0,m.jsx)(p.DeleteButton,{onClick:function(){return window.confirm("Really clean up files?")&&t.changeContent((0,m.jsx)(g,{node:t.node},"multimedia_cleanup"))},title:"Cleanup multimedia directory"},"cleanup")]},"cl"),(0,m.jsx)(c.ContentData,{mountUpdate:function(e){return t.changeContent=e}},"cda")]}):(0,m.jsx)(c.Spinner,{})}}]),n}(l.Component);f.contextType=c.RimsContext;var x=function(t){(0,o.Z)(n,t);var e=(0,u.Z)(n);function n(t){var r;return(0,s.Z)(this,n),(r=e.call(this,t)).onChange=function(t){return r.setState({data:(0,a.Z)((0,a.Z)({},r.state.data),{},(0,i.Z)({},t.target.name,t.target.value))})},r.threadChange=function(t){return r.setState((0,i.Z)({},t.target.name,t.target.checked))},r.updateInfo=function(){return(0,d.Fh)("api/multimedia/check_title",(0,a.Z)({op:"update"},r.state.data),{"X-Route":r.props.node}).then((function(t){return r.setState(t)}))},r.transferFile=function(){window.confirm("Transfer file to repository?")&&(r.state.thread?(0,d.Fh)("api/system/worker",{module:"multimedia",function:"transfer",output:!0,args:{path:r.props.path,file:r.props.file}},{"X-Route":r.props.node}).then((function(t){return r.setState({op:"transfer",result:t})})):(r.setState({wait:(0,m.jsx)(c.Spinner,{})}),(0,d.Fh)("api/multimedia/transfer",{path:r.props.path,file:r.props.file},{"X-Route":r.props.node}).then((function(t){return r.setState({op:"transfer",result:t,wait:null})}))))},r.processFile=function(){window.confirm("Process file?")&&(r.state.thread?(0,d.Fh)("api/system/worker",{module:"multimedia",function:"process",output:!0,args:(0,a.Z)({path:r.props.path,file:r.props.file},r.state.data)},{"X-Route":r.props.node}).then((function(t){return r.setState({op:"process",result:t})})):(r.setState({wait:(0,m.jsx)(c.Spinner,{})}),(0,d.Fh)("api/multimedia/process",(0,a.Z)({path:r.props.path,file:r.props.file},r.state.data),{"X-Route":r.props.node}).then((function(t){return r.setState({op:"process",result:t,wait:null})}))))},r.state={thread:!0,wait:null},r}return(0,r.Z)(n,[{key:"componentDidMount",value:function(){var t=this;(0,d.Fh)("api/multimedia/check_title",{path:this.props.path,file:this.props.file},{"X-Route":this.props.node}).then((function(e){return t.setState(e)}))}},{key:"render",value:function(){var t=this;if(this.state.op){if(this.state.thread||"transfer"===this.state.op)return(0,m.jsx)(c.InfoArticle,{header:this.state.thread?"Task activation":"Transfer",children:(0,m.jsx)(h.TextLine,{id:"result",text:JSON.stringify(this.state.result)},"mm_trans_res")},"mm_trans_article");if("NOT_OK"===this.state.result.status)return(0,m.jsx)(c.CodeArticle,{header:"Process Error",children:JSON.stringify(this.state.result.info,null,2)},"mm_error_code");var e=this.state.result.data;return(0,m.jsxs)(c.InfoArticle,{header:"Process success",children:["Elapsed time for processing file: ",this.state.result.seconds," seconds",(0,m.jsxs)(c.InfoColumns,{children:[(0,m.jsx)(h.TextLine,{id:"prefix",text:e.prefix},"mm_proc_prefix"),(0,m.jsx)(h.TextLine,{id:"suffix",text:e.suffix},"mm_proc_suffix"),(0,m.jsx)(h.TextLine,{id:"dest",label:"Destination",text:JSON.stringify(e.dest)},"mm_proc_dest"),(0,m.jsx)(h.TextLine,{id:"rename",text:JSON.stringify(e.rename)},"mm_proc_rename"),(0,m.jsx)(h.TextLine,{id:"aac",label:"Add AAC",text:JSON.stringify(e.aac_probe)},"mm_proc_aac"),(0,m.jsx)(h.TextLine,{id:"chg_aac",label:"Param AAC",text:e.changes.aac},"mm_proc_chg_aac"),(0,m.jsx)(h.TextLine,{id:"chg_aud",label:"Param Audio",text:e.changes.audio},"mm_proc_chg_aud"),(0,m.jsx)(h.TextLine,{id:"chg_sub",label:"Param Subtitles",text:e.changes.subtitle},"mm_proc_chg_sub"),(0,m.jsx)(h.TextLine,{id:"chg_srt",label:"Param SRT files",text:e.changes.srt},"mm_proc_chg_srt")]},"mm_proc_ic")]},"mm_proc_article")}if(this.state.data){var n=this.state.data;return(0,m.jsxs)(c.InfoArticle,{header:"Title",children:[(0,m.jsxs)(c.InfoColumns,{children:[(0,m.jsx)(h.TextLine,{id:"type",text:n.type},"mm_tit_type"),(0,m.jsx)(h.TextLine,{id:"title",text:n.title},"mm_tit_title"),(0,m.jsx)(h.TextLine,{id:"path",text:n.path},"mm_tit_path"),(0,m.jsx)(h.TextInput,{id:"name",value:n.name,onChange:this.onChange},"mm_tit_name"),n.epside&&(0,m.jsx)(h.TextInput,{id:"episode",value:n.episode,onChange:this.onChange},"mm_tit_eposide"),(0,m.jsx)(h.TextInput,{id:"info",value:n.info,onChange:this.onChange},"mm_tit_info"),(0,m.jsx)(h.CheckboxInput,{id:"thread",label:"Thread",value:this.state.thread,onChange:this.threadChange,title:"Thread or direct execution"},"mm_tit_thread")]},"mm_tit_ic"),(0,m.jsx)(p.StartButton,{onClick:function(){return t.processFile()},title:"Process file"},"mm_tit_btn_proc"),(0,m.jsx)(p.SyncButton,{onClick:function(){return t.transferFile()},title:"Transfer file"},"mm_tit_btn_trans"),this.state.wait]},"mm_tit_article")}return(0,m.jsx)(c.Spinner,{})}}]),n}(l.Component),_=function(t){(0,o.Z)(n,t);var e=(0,u.Z)(n);function n(t){var i;return(0,s.Z)(this,n),(i=e.call(this,t)).state={},i}return(0,r.Z)(n,[{key:"componentDidMount",value:function(){var t=this;(0,d.Fh)("api/multimedia/check_content",{path:this.props.path,file:this.props.file},{"X-Route":this.props.node}).then((function(e){return t.setState(e)}))}},{key:"render",value:function(){if(this.state.data){var t=this.state.data;return(0,m.jsx)(c.InfoArticle,{header:"Lookup",children:(0,m.jsxs)(c.InfoColumns,{children:[(0,m.jsx)(h.TextLine,{id:"file",label:"File",text:this.props.file},"mm_lu_file"),(0,m.jsx)(h.TextLine,{id:"status",label:"Result",text:this.state.status},"mm_lu_status"),(0,m.jsx)(h.TextLine,{id:"error",label:"Error",text:this.state.info},"mm_lu_error"),(0,m.jsx)(h.TextLine,{id:"video_default",label:"Video default",text:JSON.stringify(!t.video.set_default),title:"Video stream has default language"},"mm_lu_v_def"),(0,m.jsx)(h.TextLine,{id:"video_lang",label:"Video language",text:t.video.language,title:"Language set in video stream information"},"mm_lu_v_lang"),(0,m.jsx)(h.TextLine,{id:"audio_add",label:"Audio keep",text:t.audio.add.join()},"mm_lu_a_add"),(0,m.jsx)(h.TextLine,{id:"audio_rem",label:"Audio remove",text:t.audio.remove.join()},"mm_lu_a_rem"),(0,m.jsx)(h.TextLine,{id:"audio_aac",label:"Add AAC",text:JSON.stringify(t.audio.add_aac)},"mm_lu_a_aac"),(0,m.jsx)(h.TextLine,{id:"sub_add",label:"Subtitle keep",text:t.subtitle.add.join()},"mm_lu_s_add"),(0,m.jsx)(h.TextLine,{id:"sub_rem",label:"Subtitle remove",text:t.subtitle.remove.join()},"mm_lu_s_rem"),(0,m.jsx)(h.TextLine,{id:"sub_lang",label:"Subtitle languages",text:t.subtitle.languages.join()},"mm_lu_a_lang")]},"mm_lu_ic")},"mm_lu_article")}return(0,m.jsx)(c.Spinner,{})}}]),n}(l.Component),j=function(t){(0,o.Z)(n,t);var e=(0,u.Z)(n);function n(t){var i;return(0,s.Z)(this,n),(i=e.call(this,t)).state={},i}return(0,r.Z)(n,[{key:"componentDidMount",value:function(){var t=this;(0,d.Fh)("api/multimedia/check_srt",{path:this.props.path,file:this.props.file},{"X-Route":this.props.node}).then((function(e){return t.setState(e)}))}},{key:"render",value:function(){return this.state.data?(0,m.jsx)(c.InfoArticle,{header:"Extra subtitles",children:(0,m.jsxs)(c.InfoColumns,{children:[(0,m.jsx)(h.TextLine,{id:"path",text:this.props.path},"mm_sub_path"),(0,m.jsx)(h.TextLine,{id:"item",text:this.props.file},"mm_sub_item"),(0,m.jsx)(h.TextLine,{id:"name",text:this.state.data.name},"mm_sub_name"),(0,m.jsx)(h.TextLine,{id:"code",text:this.state.data.code},"mm_sub_code"),(0,m.jsx)(h.TextLine,{id:"file",text:this.state.data.file},"mm_sub_file")]},"mm_sub_ic")},"mm_sub_art"):(0,m.jsx)(c.Spinner,{})}}]),n}(l.Component),g=function(t){(0,o.Z)(n,t);var e=(0,u.Z)(n);function n(t){var i;return(0,s.Z)(this,n),(i=e.call(this,t)).state={},i}return(0,r.Z)(n,[{key:"componentDidUpdate",value:function(t){t!==this.props&&this.componentDidMount()}},{key:"componentDidMount",value:function(){var t=this;(0,d.Fh)("api/multimedia/cleanup",{},{"X-Route":this.props.node}).then((function(e){return t.setState(e)}))}},{key:"render",value:function(){return this.state.data?(0,m.jsx)(c.ContentReport,{header:"delete",thead:["Type","Path","Item","Status","Info"],trows:this.state.data,listItem:function(t){return[t.type,t.path,t.item,t.status,t.info]}},"mm_clean_cr"):(0,m.jsx)(c.Spinner,{})}}]),n}(l.Component)}}]);
//# sourceMappingURL=213.35eedbff.chunk.js.map