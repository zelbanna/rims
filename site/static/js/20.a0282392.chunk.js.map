{"version":3,"sources":["reservation.jsx"],"names":["List","props","extendItem","device_id","user_id","days","post_call","then","result","componentDidMount","deleteItem","dev","user","window","confirm","deleted","setState","data","state","filter","row","changeContent","listItem","buttons","context","settings","id","valid","alias","hostname","end","onClick","Info","title","header","thead","trows","this","New","mountUpdate","fun","Component","contextType","RimsContext","onChange","e","target","name","value","updateInfo","op","status","found","text","time_start","time_end","shutdown","options","info","device","findDevice","matching","reserveDevice","undefined","label","placeholder","Report","start","extended"],"mappings":"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","file":"static/js/20.a0282392.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport { post_call } from './infra/Functions.js';\nimport { RimsContext, Spinner, InfoArticle, InfoColumns, LineArticle, ContentList, ContentData, ContentReport } from './infra/UI.jsx';\nimport { AddButton, DeleteButton, InfoButton, ReloadButton, SaveButton, SearchButton } from './infra/Buttons.jsx';\nimport { RadioInput, TextInput, TextLine }  from './infra/Inputs.jsx';\n\n// ************** List **************\n//\nexport class List extends Component {\n constructor(props){\n  super(props);\n  this.state = {}\n }\n\n componentDidMount(){\n  post_call('api/reservation/list').then(result => this.setState(result))\n }\n\n extendItem = (device_id,user_id,days) => {\n  post_call('api/reservation/extend',{device_id:device_id, user_id:user_id, days:days}).then(result => this.componentDidMount())\n }\n\n deleteItem = (dev,user) => (window.confirm('Remove reservation?') && post_call('api/reservation/delete',{device_id:dev, user_id:user}).then(result => {\n  if (result.deleted){\n   this.setState({data:this.state.data.filter(row => (row.device_id !== dev))});\n   this.changeContent(null);\n  }}))\n\n listItem = (row) => {\n  const buttons = (this.context.settings.id === row.user_id || !row.valid);\n  return [row.alias,row.hostname,row.end,<>\n   {buttons && <InfoButton key='info' onClick={() => { this.changeContent(<Info key={'rsv_device_'+row.device_id} device_id={row.device_id} user_id={row.user_id} />) }} title='Info'/>}\n   {buttons && <AddButton  key='ext' onClick={() => { this.extendItem(row.device_id,row.user_id,14) }} title='Extend reservation' />}\n   {buttons && <DeleteButton key='del' onClick={() => { this.deleteItem(row.device_id,row.user_id) }} title='Remove reservation' />}\n  </>]\n }\n\n render(){\n  return <>\n   <ContentList key='cl' header='Reservations' thead={['User','Device','Until','']} trows={this.state.data} listItem={this.listItem}>\n    <ReloadButton key='reload' onClick={() => this.componentDidMount() } />\n    <AddButton key='add' onClick={() => this.changeContent(<New key='rsv_new' />)} />\n   </ContentList>\n   <ContentData key='cda' mountUpdate={(fun) => this.changeContent = fun} />\n  </>\n }\n}\nList.contextType = RimsContext;\n\n// ************** Info **************\n//\nclass Info extends Component {\n constructor(props){\n  super(props);\n  this.state = {data:null, found:true};\n }\n\n componentDidMount(){\n  post_call('api/reservation/info',{device_id:this.props.device_id}).then(result => this.setState(result))\n }\n\n onChange = (e) => this.setState({data:{...this.state.data, [e.target.name]:e.target.value}});\n\n updateInfo = () =>  post_call('api/reservation/info',{op:'update', ...this.state.data}).then(result => this.setState(result))\n\n extendItem = (days) => {\n  post_call('api/reservation/extend',{device_id:this.state.data.device_id, user_id:this.state.data.user_id, days:days}).then(result => result.status === 'OK' && this.componentDidMount())\n }\n\n render() {\n  if (this.state.data){\n   return <InfoArticle key='rsv_article' header='Reservation'>\n     <InfoColumns key='reservation_content'>\n      <TextLine key='alias' id='alias' text={this.state.data.alias} />\n      <TextLine key='time_start' id='Start' text={this.state.data.time_start} />\n      <TextLine key='time_end' id='End' text={this.state.data.time_end} />\n      <RadioInput key='shutdown' id='shutdown' value={this.state.data.shutdown} options={[{text:'no',value:'no'},{text:'yes',value:'yes'},{text:'reset',value:'reset'}]} onChange={this.onChange} />\n      <TextInput key='info' id='info' value={this.state.data.info} onChange={this.onChange} />\n     </InfoColumns>\n     {this.state.data.user_id === this.context.settings.id && <SaveButton key='rsv_btn_save' onClick={() => this.updateInfo()} title='Save' />}\n     {this.state.data.user_id === this.context.settings.id && <AddButton key='rsv_btn_extend' onClick={() => this.extendItem(14)} title='Extend' />}\n    </InfoArticle>\n  } else\n   return <Spinner />\n }\n}\nInfo.contextType = RimsContext;\n\n// ************** Report **************\n//\nclass New extends Component {\n constructor(props){\n  super(props)\n  this.state = {device:'',device_id:undefined,matching:''}\n }\n\n onChange = (e) => {\n  this.setState({device:e.target.value});\n }\n\n findDevice = () => post_call('api/device/search',{hostname:this.state.device}).then(result => result.found && this.setState({device_id:result.data.id,matching:result.data.hostname}));\n\n reserveDevice = () => post_call('api/reservation/new',{device_id:this.state.device_id,user_id:this.context.settings.id}).then(result => result.status === 'OK' && this.setState({device:'',device_id:undefined,matching:''}));\n\n render(){\n  return <LineArticle key='rsv_art' header='New reservation'>\n   <TextInput key='device' id='device' label='Search device' onChange={this.onChange} value={this.state.device} placeholder='search' /> found <TextLine key='matching' id='matching device' text={this.state.matching} />\n   {this.state.device && <SearchButton key='rsv_btn_search' onClick={() => this.findDevice()} title='Find device' />}\n   {this.state.device_id && <AddButton key='rsv_btn_new' onClick={() => this.reserveDevice()} title='Reserve device' />}\n   </LineArticle>\n }\n}\nNew.contextType = RimsContext;\n\n// ************** Report **************\n//\nexport class Report extends Component {\n constructor(props){\n  super(props);\n  this.state = {}\n }\n\n componentDidMount(){\n  post_call('api/reservation/list',{extended:true}).then(result => this.setState(result))\n }\n\n listItem = (row) => [row.alias,row.hostname,row.start,row.end,row.info]\n\n render(){\n  return <ContentReport key='rsv_cr' header='Reservations' thead={['User','Device','Start','End','Info']} trows={this.state.data} listItem={this.listItem} />\n }\n}\n"],"sourceRoot":""}