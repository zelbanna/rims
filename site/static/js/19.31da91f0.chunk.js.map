{"version":3,"sources":["reservation.jsx"],"names":["List","props","extendItem","device_id","user_id","days","post_call","then","result","componentDidMount","changeContent","elem","setState","content","deleteItem","dev","user","window","confirm","deleted","data","state","filter","row","listItem","buttons","context","settings","id","valid","alias","hostname","end","key","onClick","Info","title","header","thead","trows","this","New","Component","contextType","RimsContext","onChange","e","target","name","value","updateInfo","op","status","found","text","time_start","time_end","shutdown","options","info","device","findDevice","matching","reserveDevice","undefined","label","placeholder","Report","start","extended"],"mappings":"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","file":"static/js/19.31da91f0.chunk.js","sourcesContent":["import React, { Fragment, Component } from 'react';\nimport { post_call } from './infra/Functions.js';\nimport { RimsContext, Spinner, InfoArticle, InfoColumns, LineArticle, ContentList, ContentData, ContentReport } from './infra/UI.jsx';\nimport { AddButton, DeleteButton, InfoButton, ReloadButton, SaveButton, SearchButton } from './infra/Buttons.jsx';\nimport { RadioInput, TextInput, TextLine }  from './infra/Inputs.jsx';\n\n// ************** List **************\n//\nexport class List extends Component {\n constructor(props){\n  super(props);\n  this.state = {}\n }\n\n componentDidMount(){\n  post_call('api/reservation/list').then(result => this.setState({content:null, ...result}))\n }\n\n extendItem = (device_id,user_id,days) => {\n  post_call('api/reservation/extend',{device_id:device_id, user_id:user_id, days:days}).then(result => this.componentDidMount())\n }\n\n changeContent = (elem) => this.setState({content:elem})\n\n deleteItem = (dev,user) => (window.confirm('Remove reservation?') && post_call('api/reservation/delete',{device_id:dev, user_id:user}).then(result => result.deleted && this.setState({data:this.state.data.filter(row => row.device_id !== dev),content:null})))\n\n listItem = (row) => {\n  const buttons = (this.context.settings.id === row.user_id || !row.valid);\n  return [row.alias,row.hostname,row.end,<Fragment>\n   {buttons && <InfoButton key={'rsv_btn_info_'+row.device_id} onClick={() => { this.changeContent(<Info key={'rsv_device_'+row.device_id} device_id={row.device_id} user_id={row.user_id} />) }} title='Info'/>}\n   {buttons && <AddButton  key={'rsv_btn_ext_'+row.device_id}  onClick={() => { this.extendItem(row.device_id,row.user_id,14) }} title='Extend reservation' />}\n   {buttons && <DeleteButton key={'rsv_btn_del_'+row.device_id}  onClick={() => { this.deleteItem(row.device_id,row.user_id) }} title='Remove reservation' />}\n  </Fragment>]\n }\n\n render(){\n  return <Fragment>\n   <ContentList key='rsv_cl' header='Reservations' thead={['User','Device','Until','']} trows={this.state.data} listItem={this.listItem}>\n    <ReloadButton key='rsv_btn_reload' onClick={() => this.componentDidMount() } />\n    <AddButton key='rsv_btn_new' onClick={() => this.changeContent(<New key='rsv_new' />)} />\n   </ContentList>\n   <ContentData key='rsv_cd'>{this.state.content}</ContentData>\n  </Fragment>\n }\n}\nList.contextType = RimsContext;\n\n// ************** Info **************\n//\nclass Info extends Component {\n constructor(props){\n  super(props);\n  this.state = {data:null, found:true};\n }\n\n componentDidMount(){\n  post_call('api/reservation/info',{device_id:this.props.device_id}).then(result => this.setState(result))\n }\n\n onChange = (e) => this.setState({data:{...this.state.data, [e.target.name]:e.target.value}});\n\n updateInfo = () =>  post_call('api/reservation/info',{op:'update', ...this.state.data}).then(result => this.setState(result))\n\n extendItem = (days) => {\n  post_call('api/reservation/extend',{device_id:this.state.data.device_id, user_id:this.state.data.user_id, days:days}).then(result => result.status === 'OK' && this.componentDidMount())\n }\n\n render() {\n  if (this.state.data){\n   return <InfoArticle key='rsv_article' header='Reservation'>\n     <InfoColumns key='reservation_content'>\n      <TextLine key='alias' id='alias' text={this.state.data.alias} />\n      <TextLine key='time_start' id='Start' text={this.state.data.time_start} />\n      <TextLine key='time_end' id='End' text={this.state.data.time_end} />\n      <RadioInput key='shutdown' id='shutdown' value={this.state.data.shutdown} options={[{text:'no',value:'no'},{text:'yes',value:'yes'},{text:'reset',value:'reset'}]} onChange={this.onChange} />\n      <TextInput key='info' id='info' value={this.state.data.info} onChange={this.onChange} />\n     </InfoColumns>\n     {this.state.data.user_id === this.context.settings.id && <SaveButton key='rsv_btn_save' onClick={() => this.updateInfo()} title='Save' />}\n     {this.state.data.user_id === this.context.settings.id && <AddButton key='rsv_btn_extend' onClick={() => this.extendItem(14)} title='Extend' />}\n    </InfoArticle>\n  } else\n   return <Spinner />\n }\n}\nInfo.contextType = RimsContext;\n\n// ************** Report **************\n//\nclass New extends Component {\n constructor(props){\n  super(props)\n  this.state = {device:'',device_id:undefined,matching:''}\n }\n\n onChange = (e) => {\n  this.setState({device:e.target.value});\n }\n\n findDevice = () => post_call('api/device/search',{hostname:this.state.device}).then(result => result.found && this.setState({device_id:result.data.id,matching:result.data.hostname}));\n\n reserveDevice = () => post_call('api/reservation/new',{device_id:this.state.device_id,user_id:this.context.settings.id}).then(result => result.status === 'OK' && this.setState({device:'',device_id:undefined,matching:''}));\n\n render(){\n  return <LineArticle key='rsv_art' header='New reservation'>\n   <TextInput key='device' id='device' label='search device' onChange={this.onChange} value={this.state.device} placeholder='search' /> found <TextLine key='matching' id='matching device' text={this.state.matching} />\n   {this.state.device && <SearchButton key='rsv_btn_search' onClick={() => this.findDevice()} title='Find device' />}\n   {this.state.device_id && <AddButton key='rsv_btn_new' onClick={() => this.reserveDevice()} title='Reserve device' />}\n   </LineArticle>\n }\n}\nNew.contextType = RimsContext;\n\n// ************** Report **************\n//\nexport class Report extends Component {\n constructor(props){\n  super(props);\n  this.state = {}\n }\n\n componentDidMount(){\n  post_call('api/reservation/list',{extended:true}).then(result => this.setState(result))\n }\n\n listItem = (row) => [row.alias,row.hostname,row.start,row.end,row.info]\n\n render(){\n  return <ContentReport key='rsv_cr' header='Reservations' thead={['User','Device','Start','End','Info']} trows={this.state.data} listItem={this.listItem} />\n }\n}\n"],"sourceRoot":""}