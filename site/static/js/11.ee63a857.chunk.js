(this.webpackJsonprims=this.webpackJsonprims||[]).push([[11],{46:function(e,t,n){"use strict";n.r(t),n.d(t,"Main",(function(){return y})),n.d(t,"Manage",(function(){return k})),n.d(t,"Inventory",(function(){return b}));var a=n(18),i=n(15),r=n(4),o=n(5),c=n(6),s=n(7),p=n(0),u=n.n(p),l=n(12),d=n(13),h=n(19),_=n(14),m=n(16),v=n(38),y=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).listItem=function(e){var t="up"===e.ip_state;return[e.hostname,e.type_name,u.a.createElement(d.StateLeds,{state:e.ip_state}),u.a.createElement(p.Fragment,{key:"hyp_buttons_"+e.id},t&&"manage"===e.type_functions&&u.a.createElement(h.InfoButton,{key:"hyp_btn_info_"+e.id,onClick:function(){return a.context.changeMain(u.a.createElement(k,{key:"hypervisor_manage_"+e.id,device_id:e.id,type:e.type_name}))}}),t&&e.url&&e.url.length>0&&u.a.createElement(h.UiButton,{key:"hyp_ btn_ui_"+e.id,onClick:function(){return window.open(e.url,"_blank")}}))]},a.changeContent=function(e){return a.setState({content:e})},a.state={},a}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this;Object(l.c)("api/device/list",{field:"base",search:"hypervisor",extra:["type","functions","url"],sort:"hostname"}).then((function(t){return e.setState(t)}))}},{key:"render",value:function(){var e=this;return u.a.createElement(p.Fragment,{key:"hyp_fragment"},u.a.createElement(d.ContentList,{key:"hyp_cl",header:"Hypervisor",thead:["Hostname","Type","",""],trows:this.state.data,listItem:this.listItem},u.a.createElement(h.SyncButton,{key:"hyp_btn_sync",onClick:function(){return e.changeContent(u.a.createElement(f,null))}})),u.a.createElement(d.ContentData,{key:"hyp_cd"},this.state.content))}}]),n}(p.Component);y.contextType=d.RimsContext;var f=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).listItem=function(e){return[e.type,e.host_id,e.device_id,e.vm,e.device_uuid,e.config]},a.state={},a}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this;Object(l.c)("api/device/vm_mapping").then((function(t){var n=[];["existing","inventory","discovered","database"].forEach((function(e){t.hasOwnProperty(e)&&t[e].forEach((function(t){t.type=e,n.push(t)}))})),e.setState({data:n})}))}},{key:"render",value:function(){return u.a.createElement(d.ContentReport,{key:"hyp_cr",header:"VM Mapping",thead:["Status","Host","Device","VM Name","Device UUID","Config"],trows:this.state.data,listItem:this.listItem})}}]),n}(p.Component),k=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).changeContent=function(e){return a.setState({content:e})},a.state={},a}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this;Object(l.c)("api/device/management",{id:this.props.device_id}).then((function(t){e.context.loadNavigation(u.a.createElement(m.NavBar,{key:"hypervisor_navbar"},u.a.createElement(m.NavButton,{key:"hyp_nav_inv",title:"Inventory",onClick:function(){return e.changeContent(u.a.createElement(b,{key:"hypervisor_inventory",device_id:e.props.device_id,type:e.props.type}))}}),u.a.createElement(m.NavButton,{key:"hyp_nav_logs",title:"Logs",onClick:function(){return e.changeContent(u.a.createElement(v.Logs,{key:"device_logs",id:e.props.device_id}))}}),t.data.url&&t.data.url.length>0&&u.a.createElement(m.NavButton,{key:"hyp_nav_ui",title:"UI",onClick:function(){return window.open(t.data.url,"_blank")}}),u.a.createElement(m.NavInfo,{key:"hyp_nav_name",title:t.data.hostname}))),e.setState(Object(i.a)({},t,{content:u.a.createElement(b,{key:"hypervisor_inventory",device_id:e.props.device_id,type:e.props.type})}))}))}},{key:"render",value:function(){return u.a.createElement(p.Fragment,{key:"manage_base"},this.state.content)}}]),n}(p.Component);k.contextType=d.RimsContext;var b=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).changeContent=function(e){return a.setState({content:e})},a.sortList=function(e){"name"===e?a.state.data.sort((function(e,t){return e.name.localeCompare(t.name)})):a.state.data.sort((function(e,t){return e.id-t.id})),a.setState({sort:e})},a.listItem=function(e){return[e.id,e.name,u.a.createElement(E,{key:"hl_op_"+e.id,vm_id:e.id,device_id:a.props.device_id,type:a.props.type,changeContent:a.changeContent,state:e.state})]},a.state={sort:"name"},a}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this;Object(l.c)("api/"+this.props.type+"/inventory",{device_id:this.props.device_id,sort:this.state.sort}).then((function(t){return e.setState(t)}))}},{key:"render",value:function(){var e=this;if(this.state.data){var t=[u.a.createElement(h.HeaderButton,{key:"hl_btn_id",text:"ID",highlight:"id"===this.state.sort,onClick:function(){return e.sortList("id")}}),u.a.createElement(h.HeaderButton,{key:"hl_btn_vm",text:"VM",highlight:"name"===this.state.sort,onClick:function(){return e.sortList("name")}}),"Operations"];return u.a.createElement(p.Fragment,{key:"hl_fragment"},u.a.createElement(d.ContentList,{key:"hl_cl",header:"Inventory",thead:t,trows:this.state.data,listItem:this.listItem},u.a.createElement(h.ReloadButton,{key:"hl_btn_reload",onClick:function(){e.setState({data:void 0}),e.componentDidMount()}}),u.a.createElement(h.LogButton,{key:"hl_btn_logs",onClick:function(){return e.changeContent(u.a.createElement(v.Logs,{key:"device_logs",id:e.props.device_id}))},title:"Device logs"})),u.a.createElement(d.ContentData,{key:"hl_cd"},this.state.content))}return u.a.createElement(d.Spinner,null)}}]),n}(p.Component),E=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).operation=function(e){a.setState({wait:u.a.createElement(d.Spinner,null)}),Object(l.c)("api/"+a.props.type+"/vm_op",{device_id:a.props.device_id,vm_id:a.props.vm_id,op:e}).then((function(e){return a.setState(Object(i.a)({},e,{wait:null}))}))},a.snapshot=function(e){a.setState({wait:u.a.createElement(d.Spinner,null)}),Object(l.c)("api/"+a.props.type+"/vm_snapshot",{device_id:a.props.device_id,vm_id:a.props.vm_id,op:e}).then((function(e){return a.setState(Object(i.a)({},e,{wait:null}))}))},a.state={state:a.props.state,status:"",wait:null},a}return Object(o.a)(n,[{key:"render",value:function(){var e=this,t="on"===this.state.state,n="off"===this.state.state;return u.a.createElement(p.Fragment,{key:"hyp_frag_"+this.props.vm_id},u.a.createElement(h.InfoButton,{key:"hyp_btn_info_"+this.props.vm_id,onClick:function(){return e.props.changeContent(u.a.createElement(g,{key:"hypervisor_info_"+e.props.vm_id,device_id:e.props.device_id,vm_id:e.props.vm_id,type:e.props.type,changeSelf:e.props.changeContent}))},title:"VM info"}),(n||"suspended"===this.state.state)&&u.a.createElement(h.StartButton,{key:"hyp_btn_start_"+this.props.vm_id,onClick:function(){return e.operation("on")},title:this.state.status}),t&&u.a.createElement(h.StopButton,{key:"hyp_btn_stop_"+this.props.vm_id,onClick:function(){return e.operation("shutdown")},title:this.state.status}),t&&u.a.createElement(h.ReloadButton,{key:"hyp_btn_reload_"+this.props.vm_id,onClick:function(){return e.operation("reboot")},title:this.state.status}),t&&u.a.createElement(h.PauseButton,{key:"hyp_btn_suspend_"+this.props.vm_id,onClick:function(){return e.operation("suspend")},title:this.state.status}),(t||"suspended"===this.state.state)&&u.a.createElement(h.ShutdownButton,{key:"hyp_btn_shutdown_"+this.props.vm_id,onClick:function(){return e.operation("off")},title:this.state.status}),n&&u.a.createElement(h.SnapshotButton,{key:"hyp_btn_snapshot_"+this.props.vm_id,onClick:function(){return e.snapshot("create")},title:"Take snapshot"}),n&&u.a.createElement(h.ItemsButton,{key:"hyp_btn_snapshots_"+this.props.vm_id,onClick:function(){return e.props.changeContent(u.a.createElement(C,{key:"hypervisor_snapshots_"+e.props.vm_id,device_id:e.props.device_id,vm_id:e.props.vm_id,type:e.props.type}))},title:"Snapshot info"}),this.state.wait)}}]),n}(p.Component),g=function(e){Object(s.a)(y,e);var t=Object(c.a)(y);function y(e){var o;return Object(r.a)(this,y),(o=t.call(this,e)).onChange=function(e){return o.setState({data:Object(i.a)({},o.state.data,Object(a.a)({},e.target.name,e.target.value))})},o.changeSelf=function(e){return o.props.changeSelf(e)},o.changeContent=function(e){return o.setState({content:e})},o.changeImport=function(e){return n.e(1).then(n.bind(null,40)).then((function(t){return o.setState({content:u.a.createElement(t.Info,{key:"interface_info_"+e[0],device_id:o.state.data.device_id,class:"virtual",mac:e[1].mac,name:e[1].name,interface_id:e[1].interface_id,changeSelf:o.changeContent})})}))},o.state={},o}return Object(o.a)(y,[{key:"componentDidMount",value:function(){var e=this;Object(l.c)("api/"+this.props.type+"/vm_info",{device_id:this.props.device_id,vm_id:this.props.vm_id}).then((function(t){return e.setState(t)}))}},{key:"syncDatabase",value:function(){var e=this;Object(l.c)("api/"+this.props.type+"/vm_info",{device_id:this.props.device_id,vm_id:this.props.vm_id,op:"update"}).then((function(t){return e.setState(t)}))}},{key:"updateInfo",value:function(){var e=this;Object(l.c)("api/"+this.props.type+"/vm_map",{device_uuid:this.state.data.device_uuid,device_id:this.state.data.device_id,host_id:this.props.device_id,op:"update"}).then((function(t){return e.setState({update:t.update})}))}},{key:"interfaceButton",value:function(e){var t=this;return this.state.data.device_id?e[1].interface_id?u.a.createElement(h.InfoButton,{key:"hyp_if_btn_"+e[0],onClick:function(){return t.changeImport([e[0],{interface_id:e[1].interface_id}])}}):u.a.createElement(h.AddButton,{key:"hyp_if_btn_"+e[0],onClick:function(){return t.changeImport(Object(i.a)({},e,{interface_id:"new"}))}}):u.a.createElement("div",null)}},{key:"render",value:function(){var e=this;if(this.state.data){var t=this.state.data;return u.a.createElement(p.Fragment,{key:"hyp_frag"},u.a.createElement(d.InfoArticle,{key:"hyp_article",header:"VM info"},u.a.createElement(d.InfoColumns,{key:"hyp_ic",columns:3},u.a.createElement(_.TextLine,{key:"hyp_name",id:"name",text:t.name}),u.a.createElement("div",null),u.a.createElement(_.TextInput,{key:"hyp_device_id",id:"device_id",label:"Device ID",value:t.device_id,onChange:this.onChange}),u.a.createElement("div",null),u.a.createElement(_.TextLine,{key:"hyp_device_name",id:"device",label:"Device Name",text:t.device_name}),u.a.createElement("div",null),u.a.createElement(_.TextLine,{key:"hyp_snmp",id:"snmp_id",label:"SNMP id",text:t.snmp_id}),u.a.createElement("div",null),u.a.createElement(_.TextLine,{key:"hyp_uuid",id:"uuid",label:"UUID",text:t.device_uuid}),u.a.createElement("div",null),u.a.createElement(_.StateLine,{key:"hyp_state",id:"state",state:t.state}),u.a.createElement("div",null),u.a.createElement(_.TextLine,{key:"hyp_config",id:"config",text:t.config}),u.a.createElement("div",null),Object.entries(this.state.interfaces).map((function(t){return u.a.createElement(p.Fragment,{key:"hyp_intf_frag_"+t[0]},u.a.createElement(_.TextLine,{key:"hyp_intf_"+t[0],id:"interface_"+t[0],label:"Interface",text:"".concat(t[1].name," - ").concat(t[1].mac," - ").concat(t[1].port)}),e.interfaceButton(t))}))),u.a.createElement(h.SaveButton,{key:"hyp_btn_save",onClick:function(){return e.updateInfo()},title:"Save mapping"}),u.a.createElement(h.SyncButton,{key:"hyp_btn_sync",onClick:function(){return e.syncDatabase()},title:"Resync database with VM info"}),t.device_id&&u.a.createElement(h.GoButton,{key:"hyp_btn_device_vm_info",onClick:function(){return e.changeSelf(u.a.createElement(v.Info,{key:"device_info",id:t.device_id,changeSelf:e.props.changeSelf}))},title:"VM device info"}),u.a.createElement(d.Result,{key:"hyp_res",result:JSON.stringify(this.state.update)})),u.a.createElement(m.NavBar,null),this.state.content)}return u.a.createElement(d.Spinner,null)}}]),y}(p.Component),C=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).snapshot=function(e,t){a.setState({wait:u.a.createElement(d.Spinner,null)}),Object(l.c)("api/"+a.props.type+"/vm_snapshot",{device_id:a.props.device_id,vm_id:a.props.vm_id,op:e,snapshot:t}).then((function(e){return a.setState(Object(i.a)({},e,{wait:null}))}))},a.deleteList=function(e){window.confirm("Really delete snapshot?")&&(a.setState({wait:u.a.createElement(d.Spinner,null)}),Object(l.c)("api/"+a.props.type+"/vm_snapshot",{device_id:a.props.device_id,vm_id:a.props.vm_id,op:"remove",snapshot:e}).then((function(t){if(t.deleted){var n=0,i=a.state.data.filter((function(t){return t.id!==e}));i.forEach((function(e){n=n<parseInt(e.id)?parseInt(e.id):n})),a.setState({data:i,highest:n,wait:null})}})))},a.listItem=function(e){return[e.name,e.id,e.desc,e.created,e.state,u.a.createElement(p.Fragment,{key:"hyp_snap_buttons_"+e.id},u.a.createElement(h.RevertButton,{key:"hs_revert_"+e.id,onClick:function(){return a.snapshot("revert",e.id)},title:"Revert to snapshot"}),u.a.createElement(h.DeleteButton,{key:"hs_delete_"+e.id,onClick:function(){return a.deleteList(e.id)},title:"Delete snapshot"}))]},a.state={},a}return Object(o.a)(n,[{key:"componentDidMount",value:function(){this.snapshot("list",void 0)}},{key:"render",value:function(){var e=this;return u.a.createElement(d.ContentReport,{key:"hyp_snapshot_cr",header:"Snapshot (".concat(this.props.vm_id,") Highest ID:").concat(this.state.highest),thead:["Name","ID","Description","Created","State",""],trows:this.state.data,listItem:this.listItem},u.a.createElement(h.ReloadButton,{key:"hs_reload",onClick:function(){return e.snapshot("list",void 0)},title:"Reload list"}),this.state.wait)}}]),n}(p.Component)}}]);
//# sourceMappingURL=11.ee63a857.chunk.js.map