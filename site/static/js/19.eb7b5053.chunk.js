(this.webpackJsonprims=this.webpackJsonprims||[]).push([[19],{55:function(e,t,n){"use strict";n.r(t),n.d(t,"List",(function(){return f})),n.d(t,"Report",(function(){return _}));var i=n(18),a=n(14),r=n(4),o=n(5),c=n(6),d=n(7),s=n(0),u=n.n(s),l=n(12),v=n(13),h=n(20),m=n(15),f=function(e){Object(d.a)(List,e);var t=Object(c.a)(List);function List(e){var n;return Object(r.a)(this,List),(n=t.call(this,e)).extendItem=function(e,t,i){Object(l.d)("api/reservation/extend",{device_id:e,user_id:t,days:i}).then((function(e){return n.componentDidMount()}))},n.deleteItem=function(e,t){return window.confirm("Remove reservation?")&&Object(l.d)("api/reservation/delete",{device_id:e,user_id:t}).then((function(t){t.deleted&&(n.setState({data:n.state.data.filter((function(t){return t.device_id!==e}))}),n.changeContent(null))}))},n.listItem=function(e){var t=n.context.settings.id===e.user_id||!e.valid;return[e.alias,e.hostname,e.end,u.a.createElement(u.a.Fragment,null,t&&u.a.createElement(h.InfoButton,{key:"info",onClick:function onClick(){n.changeContent(u.a.createElement(p,{key:"rsv_device_"+e.device_id,device_id:e.device_id,user_id:e.user_id}))},title:"Info"}),t&&u.a.createElement(h.AddButton,{key:"ext",onClick:function onClick(){n.extendItem(e.device_id,e.user_id,14)},title:"Extend reservation"}),t&&u.a.createElement(h.DeleteButton,{key:"del",onClick:function onClick(){n.deleteItem(e.device_id,e.user_id)},title:"Remove reservation"}))]},n.state={},n}return Object(o.a)(List,[{key:"componentDidMount",value:function componentDidMount(){var e=this;Object(l.d)("api/reservation/list").then((function(t){return e.setState(t)}))}},{key:"render",value:function render(){var e=this;return u.a.createElement(u.a.Fragment,null,u.a.createElement(v.ContentList,{key:"cl",header:"Reservations",thead:["User","Device","Until",""],trows:this.state.data,listItem:this.listItem},u.a.createElement(h.ReloadButton,{key:"reload",onClick:function onClick(){return e.componentDidMount()}}),u.a.createElement(h.AddButton,{key:"add",onClick:function onClick(){return e.changeContent(u.a.createElement(k,{key:"rsv_new"}))}})),u.a.createElement(v.ContentData,{key:"cda",mountUpdate:function mountUpdate(t){return e.changeContent=t}}))}}]),List}(s.Component);f.contextType=v.RimsContext;var p=function(e){Object(d.a)(Info,e);var t=Object(c.a)(Info);function Info(e){var n;return Object(r.a)(this,Info),(n=t.call(this,e)).onChange=function(e){return n.setState({data:Object(a.a)({},n.state.data,Object(i.a)({},e.target.name,e.target.value))})},n.updateInfo=function(){return Object(l.d)("api/reservation/info",Object(a.a)({op:"update"},n.state.data)).then((function(e){return n.setState(e)}))},n.extendItem=function(e){Object(l.d)("api/reservation/extend",{device_id:n.state.data.device_id,user_id:n.state.data.user_id,days:e}).then((function(e){return"OK"===e.status&&n.componentDidMount()}))},n.state={data:null,found:!0},n}return Object(o.a)(Info,[{key:"componentDidMount",value:function componentDidMount(){var e=this;Object(l.d)("api/reservation/info",{device_id:this.props.device_id}).then((function(t){return e.setState(t)}))}},{key:"render",value:function render(){var e=this;return this.state.data?u.a.createElement(v.InfoArticle,{key:"rsv_article",header:"Reservation"},u.a.createElement(v.InfoColumns,{key:"reservation_content"},u.a.createElement(m.TextLine,{key:"alias",id:"alias",text:this.state.data.alias}),u.a.createElement(m.TextLine,{key:"time_start",id:"Start",text:this.state.data.time_start}),u.a.createElement(m.TextLine,{key:"time_end",id:"End",text:this.state.data.time_end}),u.a.createElement(m.RadioInput,{key:"shutdown",id:"shutdown",value:this.state.data.shutdown,options:[{text:"no",value:"no"},{text:"yes",value:"yes"},{text:"reset",value:"reset"}],onChange:this.onChange}),u.a.createElement(m.TextInput,{key:"info",id:"info",value:this.state.data.info,onChange:this.onChange})),this.state.data.user_id===this.context.settings.id&&u.a.createElement(h.SaveButton,{key:"rsv_btn_save",onClick:function onClick(){return e.updateInfo()},title:"Save"}),this.state.data.user_id===this.context.settings.id&&u.a.createElement(h.AddButton,{key:"rsv_btn_extend",onClick:function onClick(){return e.extendItem(14)},title:"Extend"})):u.a.createElement(v.Spinner,null)}}]),Info}(s.Component);p.contextType=v.RimsContext;var k=function(e){Object(d.a)(New,e);var t=Object(c.a)(New);function New(e){var n;return Object(r.a)(this,New),(n=t.call(this,e)).onChange=function(e){n.setState({device:e.target.value})},n.findDevice=function(){return Object(l.d)("api/device/search",{hostname:n.state.device}).then((function(e){return e.found&&n.setState({device_id:e.data.id,matching:e.data.hostname})}))},n.reserveDevice=function(){return Object(l.d)("api/reservation/new",{device_id:n.state.device_id,user_id:n.context.settings.id}).then((function(e){return"OK"===e.status&&n.setState({device:"",device_id:void 0,matching:""})}))},n.state={device:"",device_id:void 0,matching:""},n}return Object(o.a)(New,[{key:"render",value:function render(){var e=this;return u.a.createElement(v.LineArticle,{key:"rsv_art",header:"New reservation"},u.a.createElement(m.TextInput,{key:"device",id:"device",label:"Search device",onChange:this.onChange,value:this.state.device,placeholder:"search"})," found ",u.a.createElement(m.TextLine,{key:"matching",id:"matching device",text:this.state.matching}),this.state.device&&u.a.createElement(h.SearchButton,{key:"rsv_btn_search",onClick:function onClick(){return e.findDevice()},title:"Find device"}),this.state.device_id&&u.a.createElement(h.AddButton,{key:"rsv_btn_new",onClick:function onClick(){return e.reserveDevice()},title:"Reserve device"}))}}]),New}(s.Component);k.contextType=v.RimsContext;var _=function(e){Object(d.a)(Report,e);var t=Object(c.a)(Report);function Report(e){var n;return Object(r.a)(this,Report),(n=t.call(this,e)).listItem=function(e){return[e.alias,e.hostname,e.start,e.end,e.info]},n.state={},n}return Object(o.a)(Report,[{key:"componentDidMount",value:function componentDidMount(){var e=this;Object(l.d)("api/reservation/list",{extended:!0}).then((function(t){return e.setState(t)}))}},{key:"render",value:function render(){return u.a.createElement(v.ContentReport,{key:"rsv_cr",header:"Reservations",thead:["User","Device","Start","End","Info"],trows:this.state.data,listItem:this.listItem})}}]),Report}(s.Component)}}]);
//# sourceMappingURL=19.eb7b5053.chunk.js.map