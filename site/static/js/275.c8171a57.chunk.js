"use strict";(self.webpackChunkrims_frontend=self.webpackChunkrims_frontend||[]).push([[275],{275:function(t,e,n){n.r(e),n.d(e,{Main:function(){return y},Report:function(){return C}});var i=n(942),a=n(413),s=n(671),r=n(144),o=n(340),u=n(882),c=n(791),d=n(252),l=n(885),h=n(698),f=n(682),v=n(355),p=n(184),y=function(t){(0,o.Z)(n,t);var e=(0,u.Z)(n);function n(t){var i;return(0,s.Z)(this,n),(i=e.call(this,t)).compileNavItems=function(){return i.context.loadNavigation((0,p.jsxs)(v.NavBar,{children:[(0,p.jsxs)(v.NavDropDown,{title:"Activities",children:[(0,p.jsx)(v.NavDropButton,{title:"New",onClick:function(){return i.changeContent((0,p.jsx)(x,{id:"new"},"activity_info"))}},"act_nav_new"),(0,p.jsx)(v.NavDropButton,{title:"Daily",onClick:function(){return i.changeContent((0,p.jsx)(m,{changeSelf:i.changeContent},"activity_daily"))}},"act_nav_day"),(0,p.jsx)(v.NavDropButton,{title:"List",onClick:function(){return i.changeContent((0,p.jsx)(_,{},"activity_list"))}},"act_nav_list")]},"act_nav"),(0,p.jsx)(v.NavButton,{title:"Types",onClick:function(){return i.changeContent((0,p.jsx)(j,{},"activity_type_list"))}},"act_nav_types"),(0,p.jsx)(v.NavButton,{title:"Report",onClick:function(){return i.changeContent((0,p.jsx)(C,{},"activity_report"))}},"act_nav_report")]},"activity_navbar"))},i.changeContent=function(t){return i.setState(t)},i.state=(0,p.jsx)(m,{changeSelf:i.changeContent},"activity_daily"),i}return(0,r.Z)(n,[{key:"componentDidMount",value:function(){this.compileNavItems()}},{key:"componentDidUpdate",value:function(t){t!==this.props&&this.compileNavItems()}},{key:"render",value:function(){return(0,p.jsx)(p.Fragment,{children:this.state})}}]),n}(c.Component);y.contextType=l.RimsContext;var _=function(t){(0,o.Z)(n,t);var e=(0,u.Z)(n);function n(t){var i;return(0,s.Z)(this,n),(i=e.call(this,t)).listItem=function(t){return[t.date+" - "+t.time,(0,p.jsx)(f.HrefButton,{onClick:function(){return i.changeContent((0,p.jsx)(x,{id:t.id},"activity"))},text:t.type},"info_"+t.id),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(f.InfoButton,{onClick:function(){return i.changeContent((0,p.jsx)(x,{id:t.id},"activity_info"))},title:"Activity information"},"info"),(0,p.jsx)(f.DeleteButton,{onClick:function(){return i.deleteList(t.id)},title:"Delete activity"},"del")]})]},i.deleteList=function(t){return window.confirm("Delete activity")&&(0,d.Fh)("api/master/activity_delete",{id:t}).then((function(e){e.deleted&&(i.setState({data:i.state.data.filter((function(e){return e.id!==t}))}),i.changeContent(null))}))},i.state={searchfield:""},i}return(0,r.Z)(n,[{key:"componentDidMount",value:function(){var t=this;(0,d.Fh)("api/master/activity_list").then((function(e){return t.setState(e)}))}},{key:"render",value:function(){var t=this;if(this.state.data){var e=0===this.state.searchfield.length?this.state.data:this.state.data.filter((function(e){return e.type.includes(t.state.searchfield)}));return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(l.ContentList,{header:"Activities",thead:["Date","Type",""],trows:e,listItem:this.listItem,children:[(0,p.jsx)(f.ReloadButton,{onClick:function(){return t.componentDidMount()}},"reload"),(0,p.jsx)(f.AddButton,{onClick:function(){return t.changeContent((0,p.jsx)(x,{id:"new"},"activity_info"))},title:"Add activity"},"add"),(0,p.jsx)(h.SearchField,{searchFire:function(e){return t.setState({searchfield:e})},placeholder:"Search activities"},"search")]},"cl"),(0,p.jsx)(l.ContentData,{mountUpdate:function(e){return t.changeContent=e}},"cda")]})}return(0,p.jsx)(l.Spinner,{})}}]),n}(c.Component),x=function(t){(0,o.Z)(n,t);var e=(0,u.Z)(n);function n(t){var r;return(0,s.Z)(this,n),(r=e.call(this,t)).onChange=function(t){return r.setState({data:(0,a.Z)((0,a.Z)({},r.state.data),{},(0,i.Z)({},t.target.name,t.target.value))})},r.updateInfo=function(){(0,d.Fh)("api/master/activity_info",(0,a.Z)({op:"update"},r.state.data)).then((function(t){return r.setState(t)}))},r.state={data:null},r}return(0,r.Z)(n,[{key:"componentDidUpdate",value:function(t){var e=this;t!==this.props&&(0,d.Fh)("api/master/activity_info",{id:this.props.id}).then((function(t){null===t.data.user_id&&(t.data.user_id=e.context.settings.id),e.setState(t)}))}},{key:"componentDidMount",value:function(){var t=this;(0,d.Fh)("api/master/activity_info",{id:this.props.id,extras:["types","users"]}).then((function(e){null===e.data.user_id&&(e.data.user_id=t.context.settings.id),t.setState(e)}))}},{key:"render",value:function(){var t=this;return this.state.data?(0,p.jsxs)(l.InfoArticle,{header:"Activity",children:[(0,p.jsxs)(l.InfoColumns,{children:[(0,p.jsx)(h.TextLine,{id:"id",label:"ID",text:this.state.data.id},"ai_id"),(0,p.jsx)(h.SelectInput,{id:"user_id",label:"User",value:this.state.data.user_id,onChange:this.onChange,children:this.state.users.map((function(t,e){return(0,p.jsx)("option",{value:t.id,children:t.alias},e)}))},"ai_user_id"),(0,p.jsx)(h.SelectInput,{id:"type_id",label:"Type",value:this.state.data.type_id,onChange:this.onChange,children:this.state.types.map((function(t,e){return(0,p.jsx)("option",{value:t.id,children:t.type},e)}))},"ai_type_id"),(0,p.jsx)(h.DateInput,{id:"date",value:this.state.data.date,onChange:this.onChange},"ai_date"),(0,p.jsx)(h.TimeInput,{id:"time",value:this.state.data.time,onChange:this.onChange},"ai_time")]},"ai_content"),(0,p.jsx)(h.TextAreaInput,{id:"event",value:this.state.data.event,onChange:this.onChange},"ai_event"),(0,p.jsx)(f.SaveButton,{onClick:function(){return t.updateInfo()},title:"Save"},"ai_btn_save"),(0,p.jsx)(l.Result,{result:JSON.stringify(this.state.update)},"ai_result")]},"ai_art"):(0,p.jsx)(l.Spinner,{})}}]),n}(c.Component);x.contextType=l.RimsContext;var m=function(t){(0,o.Z)(n,t);var e=(0,u.Z)(n);function n(t){var r;(0,s.Z)(this,n),(r=e.call(this,t)).changeContent=function(t){return r.props.changeSelf(t)},r.deleteList=function(t){return window.confirm("Delete activity")&&(0,d.Fh)("api/master/activity_delete",{id:t}).then((function(e){if(e.deleted){var n=r.state.data.findIndex((function(e){return e.act_id===t})),i=r.state.data[n];Object.assign(i,{user_id:null,event:null,act_id:null}),r.setState({data:r.state.data})}}))},r.onChange=function(t){var e=t.target.name,n=t.target.value,s={date:"date"===e?n:r.state.date};(0,d.Fh)("api/master/activity_daily",s).then((function(t){return r.setState((0,a.Z)((0,a.Z)({},t),{},(0,i.Z)({},e,n)))}))},r.syncEvent=function(t,e){return(0,d.Fh)("api/master/activity_info",{op:"update",id:e||"new",user_id:r.state.user_id,type_id:t,event:"auto",date:r.state.date}).then((function(e){if(e.update){var n=r.state.data.findIndex((function(e){return e.id===t})),i=r.state.data[n];Object.assign(i,{user_id:r.state.user_id,event:"auto",act_id:e.data.id}),r.setState({data:r.state.data})}}))},r.listItem=function(t){return[t.type,t.user_id?r.state.users[t.user_id].alias:"-",t.event?t.event:"-",(0,p.jsxs)(p.Fragment,{children:[!t.user_id&&(0,p.jsx)(f.AddButton,{onClick:function(){return r.syncEvent(t.id,t.act_id)}},"add"),t.user_id&&t.user_id!==parseInt(r.state.user_id)&&(0,p.jsx)(f.SyncButton,{onClick:function(){return r.syncEvent(t.id,t.act_id)}},"sync"),t.act_id&&(0,p.jsx)(f.InfoButton,{onClick:function(){return r.changeContent((0,p.jsx)(x,{id:t.act_id},"activity_"+t.act_id))}},"info"),t.act_id&&(0,p.jsx)(f.DeleteButton,{onClick:function(){return r.deleteList(t.act_id)}},"del")]})]};var o=new Date(Date.now());return r.state={data:[],date:o.toISOString().substring(0,10),user_id:void 0,users:{}},r}return(0,r.Z)(n,[{key:"componentDidMount",value:function(){var t=this;(0,d.Fh)("api/master/activity_daily",{extras:["users"]}).then((function(e){return t.setState((0,a.Z)((0,a.Z)({},e),{},{user_id:t.context.settings.id}))}))}},{key:"render",value:function(){var t=this;return this.state.data?(0,p.jsxs)(l.ContentReport,{header:"Activities",thead:["Type","User","Event",""],trows:this.state.data,listItem:this.listItem,children:[(0,p.jsx)(f.ReloadButton,{onClick:function(){return t.componentDidMount()}},"reload"),(0,p.jsx)(h.SelectInput,{id:"user_id",label:"User",value:this.state.user_id,onChange:this.onChange,children:Object.values(this.state.users).map((function(t,e){return(0,p.jsx)("option",{value:t.id,children:t.alias},e)}))},"user_id"),(0,p.jsx)(h.DateInput,{id:"date",value:this.state.date,onChange:this.onChange},"date")]},"cr"):(0,p.jsx)(l.Spinner,{})}}]),n}(c.Component);m.contextType=l.RimsContext;var C=function(t){(0,o.Z)(n,t);var e=(0,u.Z)(n);function n(t){var i;return(0,s.Z)(this,n),(i=e.call(this,t)).listItem=function(t){return[t.date+" - "+t.time,t.user,t.type,t.class,t.event]},i.state={},i}return(0,r.Z)(n,[{key:"componentDidMount",value:function(){var t=this;(0,d.Fh)("api/master/activity_list",{group:"month",mode:"full"}).then((function(e){return t.setState(e)}))}},{key:"render",value:function(){return(0,p.jsx)(l.ContentReport,{header:"Activities",thead:["Time","User","Type","Class","Event"],trows:this.state.data,listItem:this.listItem},"act_cr")}}]),n}(c.Component),j=function(t){(0,o.Z)(n,t);var e=(0,u.Z)(n);function n(t){var i;return(0,s.Z)(this,n),(i=e.call(this,t)).listItem=function(t){return[t.id,t.type,t.class,(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(f.ConfigureButton,{onClick:function(){return i.changeContent((0,p.jsx)(g,{id:t.id},"act_tp"))},title:"Edit type information"},"info"),(0,p.jsx)(f.DeleteButton,{onClick:function(){return i.deleteList(t.id)},title:"Delete type"},"delete")]})]},i.deleteList=function(t){return window.confirm("Really delete type?")&&(0,d.Fh)("api/master/activity_type_delete",{id:t}).then((function(e){e.deleted&&(i.setState({data:i.state.data.filter((function(e){return e.id!==t}))}),i.changeContent(null))}))},i.state={},i}return(0,r.Z)(n,[{key:"componentDidMount",value:function(){var t=this;(0,d.Fh)("api/master/activity_type_list").then((function(e){return t.setState(e)}))}},{key:"render",value:function(){var t=this;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(l.ContentList,{header:"Activity Types",thead:["ID","Type","Class",""],trows:this.state.data,listItem:this.listItem,children:[(0,p.jsx)(f.ReloadButton,{onClick:function(){return t.componentDidMount()}},"reload"),(0,p.jsx)(f.AddButton,{onClick:function(){return t.changeContent((0,p.jsx)(g,{id:"new"},"act_tp"))},title:"Add activity type"},"add")]},"cl"),(0,p.jsx)(l.ContentData,{mountUpdate:function(e){return t.changeContent=e}},"cda")]})}}]),n}(c.Component),g=function(t){(0,o.Z)(n,t);var e=(0,u.Z)(n);function n(t){var r;return(0,s.Z)(this,n),(r=e.call(this,t)).onChange=function(t){return r.setState({data:(0,a.Z)((0,a.Z)({},r.state.data),{},(0,i.Z)({},t.target.name,t.target.value))})},r.changeContent=function(t){return r.setState({content:t})},r.updateInfo=function(){return(0,d.Fh)("api/master/activity_type_info",(0,a.Z)({op:"update"},r.state.data)).then((function(t){return r.setState(t)}))},r.state={data:null,content:null},r}return(0,r.Z)(n,[{key:"componentDidUpdate",value:function(t){var e=this;t!==this.props&&(0,d.Fh)("api/master/activity_type_info",{id:this.props.id}).then((function(t){return e.setState(t)}))}},{key:"componentDidMount",value:function(){var t=this;(0,d.Fh)("api/master/activity_type_info",{id:this.props.id}).then((function(e){return t.setState(e)}))}},{key:"render",value:function(){var t=this;return this.state.data?(0,p.jsxs)(l.InfoArticle,{header:"Activity Type",children:[(0,p.jsxs)(l.InfoColumns,{children:[(0,p.jsx)(h.TextLine,{id:"id",text:this.state.data.id},"id"),(0,p.jsx)(h.TextInput,{id:"type",value:this.state.data.type,onChange:this.onChange,placeholder:"name"},"type"),(0,p.jsx)(h.SelectInput,{id:"class",value:this.state.data.class,onChange:this.onChange,children:this.state.classes.map((function(t){return(0,p.jsx)("option",{value:t,children:t},t)}))},"class")]},"ic"),(0,p.jsx)(f.SaveButton,{onClick:function(){return t.updateInfo()},title:"Save"},"save")]},"ia_at"):(0,p.jsx)(l.Spinner,{})}}]),n}(c.Component)}}]);
//# sourceMappingURL=275.c8171a57.chunk.js.map