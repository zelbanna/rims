"use strict";(self.webpackChunkrims_frontend=self.webpackChunkrims_frontend||[]).push([[125],{125:(t,e,s)=>{s.r(e),s.d(e,{DomainList:()=>c,Main:()=>h});var n=s(43),i=s(524),a=s(662),o=s(97),r=s(728),d=s(579);class h extends n.Component{constructor(){super(...arguments),this.changeContent=t=>this.setState(t)}componentDidMount(){this.setState((0,d.jsx)(c,{},"domain_list"))}render(){return(0,d.jsx)(d.Fragment,{children:this.state})}}class c extends n.Component{constructor(t){super(t),this.listItem=t=>[t.id,t.name,t.service,(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.ConfigureButton,{onClick:()=>this.changeContent((0,d.jsx)(l,{id:t.id},"domain_info")),title:"Edit domain information"},"info"),(0,d.jsx)(r.ItemsButton,{onClick:()=>this.changeContent((0,d.jsx)(u,{changeSelf:this.changeContent,domain_id:t.id},"record_list")),title:"View domain records"},"items"),(0,d.jsx)(r.DeleteButton,{onClick:()=>this.deleteList(t.id),title:"Delete domain"},"del")]})],this.changeContent=t=>this.setState({content:t}),this.deleteList=t=>window.confirm("Really delete domain")&&(0,i.Cc)("api/dns/domain_delete",{id:t}).then(e=>{e.deleted&&(this.setState({data:this.state.data.filter(e=>e.id!==t)}),this.changeContent(null))}),this.state={}}componentDidMount(){(0,i.Cc)("api/dns/domain_list").then(t=>{t.result="OK",this.setState(t)})}syncDomains(){(0,i.Cc)("api/dns/domain_list",{sync:!0}).then(t=>{t.result="NS:"+t.ns.status+", Recursors:"+t.rec.status,this.setState(t)})}render(){return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(a.ContentList,{header:"Domains",thead:["ID","Domain","Server",""],trows:this.state.data,listItem:this.listItem,result:this.state.result,children:[(0,d.jsx)(r.ReloadButton,{onClick:()=>this.componentDidMount()},"reload"),(0,d.jsx)(r.AddButton,{onClick:()=>this.changeContent((0,d.jsx)(l,{id:"new"},"domain_info")),title:"Add domain"},"add"),(0,d.jsx)(r.SyncButton,{onClick:()=>this.syncDomains(),title:"Sync external DNS servers with cache"},"sync"),(0,d.jsx)(r.HealthButton,{onClick:()=>this.changeContent((0,d.jsx)(p,{},"recursor_statistics")),title:"View DNS statistics"},"stats")]},"cl"),(0,d.jsx)(a.ContentData,{mountUpdate:t=>this.changeContent=t},"cda")]})}}class l extends n.Component{constructor(t){super(t),this.onChange=t=>this.setState({data:{...this.state.data,[t.target.name]:t.target.value}}),this.changeContent=t=>this.setState({content:t}),this.updateInfo=()=>(0,i.Cc)("api/dns/domain_info",{op:"update",...this.state.data}).then(t=>this.setState(t)),this.state={data:null}}componentDidUpdate(t){t!==this.props&&this.componentDidMount()}componentDidMount(){(0,i.Cc)("api/dns/domain_info",{id:this.props.id}).then(t=>this.setState(t))}render(){if(this.state.data){const t="new"!==this.state.data.id;return(0,d.jsxs)(a.InfoArticle,{header:"Domain",children:[(0,d.jsxs)(a.InfoColumns,{children:[t&&(0,d.jsx)(o.TextLine,{id:"node",text:this.state.infra.node},"node"),t&&(0,d.jsx)(o.TextLine,{id:"service",text:this.state.infra.service},"service"),t&&(0,d.jsx)(o.TextLine,{id:"foreign_id",label:"Foreign ID",text:this.state.infra.foreign_id},"foreign_id"),!t&&(0,d.jsx)(o.SelectInput,{id:"server_id",label:"Server",value:this.state.data.server_id,onChange:this.onChange,children:this.state.servers.map((t,e)=>(0,d.jsx)("option",{value:t.id,children:`${t.service}@${t.node}`},"srv_"+e))},"server_id"),(0,d.jsx)(o.TextInput,{id:"name",value:this.state.data.name,onChange:this.onChange},"name"),(0,d.jsx)(o.TextInput,{id:"master",value:this.state.data.master,onChange:this.onChange},"master"),(0,d.jsx)(o.TextInput,{id:"type",value:this.state.data.type,onChange:this.onChange},"type"),(0,d.jsx)(o.TextLine,{id:"serial",text:this.state.data.serial},"serial")]},"ic"),(0,d.jsx)(r.SaveButton,{onClick:()=>this.updateInfo(),title:"Save domain information"},"save")]},"ia_dom")}return(0,d.jsx)(a.Spinner,{})}}class p extends n.Component{constructor(t){super(t),this.state={}}componentDidMount(){(0,i.Cc)("api/dns/statistics").then(t=>{const e=[];for(let[n,i]of Object.entries(t.queries)){const t=n.split("_");i.forEach(s=>e.push([t[0],t[1],s[0],s[1],s[2]]))}const s=[];for(let[n,i]of Object.entries(t.remotes)){const t=n.split("_");i.forEach(e=>s.push([t[0],t[1],e[0],e[1]]))}this.setState({queries:e,remotes:s})})}render(){return this.state.queries&&this.state.remotes?(0,d.jsxs)(a.Flex,{children:[(0,d.jsx)(a.ContentReport,{header:"Looked up FQDN",thead:["Node","Service","Hits","FQDN","Type"],trows:this.state.queries,listItem:t=>t},"queries_cr"),(0,d.jsx)(a.ContentReport,{header:"Queriers",thead:["Node","Service","Hits","Who"],trows:this.state.remotes,listItem:t=>t},"remotes_cr")]},"statistics_flex"):(0,d.jsx)(a.Spinner,{})}}class u extends n.Component{constructor(t){super(t),this.changeContent=t=>this.props.changeSelf(t),this.listItem=t=>[t.name,t.content,t.type,t.ttl,(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.ConfigureButton,{onClick:()=>this.changeContent((0,d.jsx)(m,{domain_id:this.props.domain_id,op:"info",...t},"record_info")),title:"Configure record"},"info"),["A","AAAA","CNAME","PTR","DHCID"].includes(t.type)&&(0,d.jsx)(r.DeleteButton,{onClick:()=>this.deleteList(t.name,t.type),title:"Delete record"},"del")]})],this.deleteList=(t,e)=>window.confirm("Delete record?")&&(0,i.Cc)("api/dns/record_delete",{domain_id:this.props.domain_id,name:t,type:e}).then(s=>s.deleted&&this.setState({data:this.state.data.filter(s=>!(s.name===t&&s.type===e))})),this.state={}}componentDidUpdate(t){t!==this.props&&this.componentDidMount()}componentDidMount(){(0,i.Cc)("api/dns/record_list",{domain_id:this.props.domain_id}).then(t=>this.setState(t))}render(){const t=this.state.status;if(t){if("OK"===t){const t=this.state.data;return(0,d.jsxs)(a.ContentReport,{header:"Records",thead:["Name","Content","Type","TTL",""],trows:t,listItem:this.listItem,result:this.state.result,children:[(0,d.jsx)(r.ReloadButton,{onClick:()=>this.componentDidMount()},"reload"),(0,d.jsx)(r.AddButton,{onClick:()=>this.changeContent((0,d.jsx)(m,{domain_id:this.props.domain_id,name:"new",op:"new"},"record_info")),title:"Add DNS record"},"add")]},"rl_cr")}return(0,d.jsxs)(a.CodeArticle,{children:["Error retrieving record list: ",JSON.stringify(this.state.info)]},"ca_rl")}return(0,d.jsx)(a.Spinner,{})}}class m extends n.Component{constructor(t){super(t),this.onChange=t=>this.setState({data:{...this.state.data,[t.target.name]:t.target.value}}),this.updateInfo=()=>(0,i.Cc)("api/dns/record_info",{op:this.state.op,...this.state.data}).then(t=>{this.setState({op:"OK"===t.status?"update":this.state.op,...t})}),this.state={data:null,info:void 0},"info"===this.props.op?(this.state.data={domain_id:this.props.domain_id,name:this.props.name,type:this.props.type,ttl:this.props.ttl,content:this.props.content},this.state.op="update"):(this.state.data={domain_id:this.props.domain_id,name:"",type:"A",ttl:3600,content:""},this.state.op="insert")}render(){return this.state.data?(0,d.jsxs)(a.InfoArticle,{header:"Record",children:[(0,d.jsxs)(a.InfoColumns,{children:[(0,d.jsx)(o.TextInput,{id:"name",value:this.state.data.name,title:"E.g. A:FQDN, PTR:x.y.z.in-addr.arpa",onChange:this.onChange,placeholder:"name"},"name"),(0,d.jsx)(o.TextInput,{id:"type",value:this.state.data.type,onChange:this.onChange,placeholder:"A, PTR or CNAME typically"},"type"),(0,d.jsx)(o.TextInput,{id:"ttl",label:"TTL",value:this.state.data.ttl,onChange:this.onChange},"ttl"),(0,d.jsx)(o.TextInput,{id:"content",value:this.state.data.content,title:"E.g. A:IP, PTR:x.y.x-inaddr.arpa, CNAME:A - remember dot on PTR/CNAME",onChange:this.onChange,placeholder:"content"},"content"),this.props.serial&&(0,d.jsx)(o.TextLine,{id:"serial",text:this.props.serial},"serial")]},"ic"),(0,d.jsx)(r.SaveButton,{onClick:()=>this.updateInfo(),title:"Save record information"},"save"),(0,d.jsx)(a.Result,{result:"OK"!==this.state.status?JSON.stringify(this.state.info):"OK"},"result")]},"rec_art"):(0,d.jsx)(a.Spinner,{})}}}}]);
//# sourceMappingURL=125.7434aa49.chunk.js.map