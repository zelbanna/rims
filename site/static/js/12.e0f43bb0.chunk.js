(this.webpackJsonprims=this.webpackJsonprims||[]).push([[12],{48:function(e,t,n){"use strict";n.r(t),n.d(t,"Main",(function(){return y})),n.d(t,"DomainList",(function(){return k}));var a=n(19),i=n(18),o=n(14),r=n(4),c=n(5),s=n(6),l=n(7),d=n(0),u=n.n(d),m=n(12),p=n(13),h=n(15),f=n(20),y=function(e){Object(l.a)(Main,e);var t=Object(s.a)(Main);function Main(){var e;Object(r.a)(this,Main);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).changeContent=function(t){return e.setState(t)},e}return Object(c.a)(Main,[{key:"componentDidMount",value:function componentDidMount(){this.setState(u.a.createElement(k,{key:"domain_list"}))}},{key:"render",value:function render(){return u.a.createElement(u.a.Fragment,null,this.state)}}]),Main}(d.Component),k=function(e){Object(l.a)(DomainList,e);var t=Object(s.a)(DomainList);function DomainList(e){var n;return Object(r.a)(this,DomainList),(n=t.call(this,e)).listItem=function(e){return[e.id,e.name,e.service,u.a.createElement(u.a.Fragment,null,u.a.createElement(f.ConfigureButton,{key:"info",onClick:function onClick(){return n.changeContent(u.a.createElement(C,{key:"domain_info",id:e.id}))},title:"Edit domain information"}),u.a.createElement(f.ItemsButton,{key:"items",onClick:function onClick(){return n.changeContent(u.a.createElement(E,{changeSelf:n.changeContent,key:"record_list",domain_id:e.id}))},title:"View domain records"}),u.a.createElement(f.DeleteButton,{key:"del",onClick:function onClick(){return n.deleteList(e.id)},title:"Delete domain"}))]},n.changeContent=function(e){return n.setState({content:e})},n.deleteList=function(e){return window.confirm("Really delete domain")&&Object(m.d)("api/dns/domain_delete",{id:e}).then((function(t){t.deleted&&(n.setState({data:n.state.data.filter((function(t){return t.id!==e}))}),n.changeContent(null))}))},n.state={},n}return Object(c.a)(DomainList,[{key:"componentDidMount",value:function componentDidMount(){var e=this;Object(m.d)("api/dns/domain_list").then((function(t){t.result="OK",e.setState(t)}))}},{key:"syncDomains",value:function syncDomains(){var e=this;Object(m.d)("api/dns/domain_list",{sync:!0}).then((function(t){t.result="NS:"+t.ns.status+", Recursors:"+t.rec.status,e.setState(t)}))}},{key:"render",value:function render(){var e=this;return u.a.createElement(u.a.Fragment,null,u.a.createElement(p.ContentList,{key:"cl",header:"Domains",thead:["ID","Domain","Server",""],trows:this.state.data,listItem:this.listItem,result:this.state.result},u.a.createElement(f.ReloadButton,{key:"reload",onClick:function onClick(){return e.componentDidMount()}}),u.a.createElement(f.AddButton,{key:"add",onClick:function onClick(){return e.changeContent(u.a.createElement(C,{key:"domain_info",id:"new"}))},title:"Add domain"}),u.a.createElement(f.SyncButton,{key:"sync",onClick:function onClick(){return e.syncDomains()},title:"Sync external DNS servers with cache"}),u.a.createElement(f.HealthButton,{key:"stats",onClick:function onClick(){return e.changeContent(u.a.createElement(v,{key:"recursor_statistics"}))},title:"View DNS statistics"})),u.a.createElement(p.ContentData,{key:"cda",mountUpdate:function mountUpdate(t){return e.changeContent=t}}))}}]),DomainList}(d.Component),C=function(e){Object(l.a)(DomainInfo,e);var t=Object(s.a)(DomainInfo);function DomainInfo(e){var n;return Object(r.a)(this,DomainInfo),(n=t.call(this,e)).onChange=function(e){return n.setState({data:Object(o.a)({},n.state.data,Object(i.a)({},e.target.name,e.target.value))})},n.changeContent=function(e){return n.setState({content:e})},n.updateInfo=function(){return Object(m.d)("api/dns/domain_info",Object(o.a)({op:"update"},n.state.data)).then((function(e){return n.setState(e)}))},n.state={data:null},n}return Object(c.a)(DomainInfo,[{key:"componentDidUpdate",value:function componentDidUpdate(e){e!==this.props&&this.componentDidMount()}},{key:"componentDidMount",value:function componentDidMount(){var e=this;Object(m.d)("api/dns/domain_info",{id:this.props.id}).then((function(t){return e.setState(t)}))}},{key:"render",value:function render(){var e=this;if(this.state.data){var t="new"!==this.state.data.id;return u.a.createElement(p.InfoArticle,{key:"ia_dom",header:"Domain"},u.a.createElement(p.InfoColumns,{key:"ic"},t&&u.a.createElement(h.TextLine,{key:"node",id:"node",text:this.state.infra.node}),t&&u.a.createElement(h.TextLine,{key:"service",id:"service",text:this.state.infra.service}),t&&u.a.createElement(h.TextLine,{key:"foreign_id",id:"foreign_id",label:"Foreign ID",text:this.state.infra.foreign_id}),!t&&u.a.createElement(h.SelectInput,{key:"server_id",id:"server_id",label:"Server",value:this.state.data.server_id,onChange:this.onChange},this.state.servers.map((function(e,t){return u.a.createElement("option",{key:"srv_"+t,value:e.id},"".concat(e.service,"@").concat(e.node))}))),u.a.createElement(h.TextInput,{key:"name",id:"name",value:this.state.data.name,onChange:this.onChange}),u.a.createElement(h.TextInput,{key:"master",id:"master",value:this.state.data.master,onChange:this.onChange}),u.a.createElement(h.TextInput,{key:"type",id:"type",value:this.state.data.type,onChange:this.onChange}),u.a.createElement(h.TextLine,{key:"serial",id:"serial",text:this.state.data.serial})),u.a.createElement(f.SaveButton,{key:"save",onClick:function onClick(){return e.updateInfo()},title:"Save domain information"}))}return u.a.createElement(p.Spinner,null)}}]),DomainInfo}(d.Component),v=function(e){Object(l.a)(Statistics,e);var t=Object(s.a)(Statistics);function Statistics(e){var n;return Object(r.a)(this,Statistics),(n=t.call(this,e)).state={},n}return Object(c.a)(Statistics,[{key:"componentDidMount",value:function componentDidMount(){var e=this;Object(m.d)("api/dns/statistics").then((function(t){for(var n=[],i=function _loop(){var e=Object(a.a)(r[o],2),t=e[0],i=e[1],c=t.split("_");i.forEach((function(e){return n.push([c[0],c[1],e[0],e[1],e[2]])}))},o=0,r=Object.entries(t.queries);o<r.length;o++)i();for(var c=[],s=function _loop2(){var e=Object(a.a)(d[l],2),t=e[0],n=e[1],i=t.split("_");n.forEach((function(e){return c.push([i[0],i[1],e[0],e[1]])}))},l=0,d=Object.entries(t.remotes);l<d.length;l++)s();e.setState({queries:n,remotes:c})}))}},{key:"render",value:function render(){return this.state.queries&&this.state.remotes?u.a.createElement(p.Flex,{key:"statistics_flex"},u.a.createElement(p.ContentReport,{key:"queries_cr",header:"Looked up FQDN",thead:["Node","Service","Hits","FQDN","Type"],trows:this.state.queries,listItem:function listItem(e){return e}}),u.a.createElement(p.ContentReport,{key:"remotes_cr",header:"Queriers",thead:["Node","Service","Hits","Who"],trows:this.state.remotes,listItem:function listItem(e){return e}})):u.a.createElement(p.Spinner,null)}}]),Statistics}(d.Component),E=function(e){Object(l.a)(RecordList,e);var t=Object(s.a)(RecordList);function RecordList(e){var n;return Object(r.a)(this,RecordList),(n=t.call(this,e)).changeContent=function(e){return n.props.changeSelf(e)},n.listItem=function(e){return[e.name,e.content,e.type,e.ttl,u.a.createElement(u.a.Fragment,null,u.a.createElement(f.ConfigureButton,{key:"info",onClick:function onClick(){return n.changeContent(u.a.createElement(g,Object.assign({key:"record_info",domain_id:n.props.domain_id,op:"info"},e)))},title:"Configure record"}),["A","AAAA","CNAME","PTR"].includes(e.type)&&u.a.createElement(f.DeleteButton,{key:"del",onClick:function onClick(){return n.deleteList(e.name,e.type)},title:"Delete record"}))]},n.deleteList=function(e,t){return window.confirm("Delete record?")&&Object(m.d)("api/dns/record_delete",{domain_id:n.props.domain_id,name:e,type:t}).then((function(a){return a.deleted&&n.setState({data:n.state.data.filter((function(n){return!(n.name===e&&n.type===t)}))})}))},n.state={},n}return Object(c.a)(RecordList,[{key:"componentDidUpdate",value:function componentDidUpdate(e){e!==this.props&&this.componentDidMount()}},{key:"componentDidMount",value:function componentDidMount(){var e=this;Object(m.d)("api/dns/record_list",{domain_id:this.props.domain_id}).then((function(t){return e.setState(t)}))}},{key:"render",value:function render(){var e=this,t=this.state.status;if(t){if("OK"===t){var n=this.state.data;return u.a.createElement(p.ContentReport,{key:"rl_cr",header:"Records",thead:["Name","Content","Type","TTL",""],trows:n,listItem:this.listItem,result:this.state.result},u.a.createElement(f.ReloadButton,{key:"reload",onClick:function onClick(){return e.componentDidMount()}}),u.a.createElement(f.AddButton,{key:"add",onClick:function onClick(){return e.changeContent(u.a.createElement(g,{key:"record_info",domain_id:e.props.domain_id,name:"new",op:"new"}))},title:"Add DNS record"}))}return u.a.createElement(p.CodeArticle,{key:"ca_rl"},"Error retrieving record list: ",JSON.stringify(this.state.info))}return u.a.createElement(p.Spinner,null)}}]),RecordList}(d.Component),g=function(e){Object(l.a)(RecordInfo,e);var t=Object(s.a)(RecordInfo);function RecordInfo(e){var n;return Object(r.a)(this,RecordInfo),(n=t.call(this,e)).onChange=function(e){return n.setState({data:Object(o.a)({},n.state.data,Object(i.a)({},e.target.name,e.target.value))})},n.updateInfo=function(){return Object(m.d)("api/dns/record_info",Object(o.a)({op:n.state.op},n.state.data)).then((function(e){n.setState(Object(o.a)({op:"OK"===e.status?"update":n.state.op},e))}))},n.state={data:null,info:void 0},"info"===n.props.op?(n.state.data={domain_id:n.props.domain_id,name:n.props.name,type:n.props.type,ttl:n.props.ttl,content:n.props.content},n.state.op="update"):(n.state.data={domain_id:n.props.domain_id,name:"",type:"A",ttl:3600,content:""},n.state.op="insert"),n}return Object(c.a)(RecordInfo,[{key:"render",value:function render(){var e=this;return this.state.data?u.a.createElement(p.InfoArticle,{key:"rec_art",header:"Record"},u.a.createElement(p.InfoColumns,{key:"ic"},u.a.createElement(h.TextInput,{key:"name",id:"name",value:this.state.data.name,title:"E.g. A:FQDN, PTR:x.y.z.in-addr.arpa",onChange:this.onChange,placeholder:"name"}),u.a.createElement(h.TextInput,{key:"type",id:"type",value:this.state.data.type,onChange:this.onChange,placeholder:"A, PTR or CNAME typically"}),u.a.createElement(h.TextInput,{key:"ttl",id:"ttl",label:"TTL",value:this.state.data.ttl,onChange:this.onChange}),u.a.createElement(h.TextInput,{key:"content",id:"content",value:this.state.data.content,title:"E.g. A:IP, PTR:x.y.x-inaddr.arpa, CNAME:A - remember dot on PTR/CNAME",onChange:this.onChange,placeholder:"content"}),this.props.serial&&u.a.createElement(h.TextLine,{key:"serial",id:"serial",text:this.props.serial})),u.a.createElement(f.SaveButton,{key:"save",onClick:function onClick(){return e.updateInfo()},title:"Save record information"}),u.a.createElement(p.Result,{key:"result",result:"OK"!==this.state.status?JSON.stringify(this.state.info):"OK"})):u.a.createElement(p.Spinner,null)}}]),RecordInfo}(d.Component)}}]);
//# sourceMappingURL=12.e0f43bb0.chunk.js.map