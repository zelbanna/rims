{"version":3,"sources":["system.jsx"],"names":["Main","props","compileNavItems","master","context","settings","node","admin","class","master_admin","loadNavigation","title","onClick","changeImport","window","open","changeContent","Controls","Report","RestList","state","navinfo","map","row","idx","elem","setState","content","navitems","logs","post_call","user_id","this","id","then","result","Object","assign","prevProps","module","func","args","lib","Elem","Component","contextType","RimsContext","listItem","info","value","data","keys","sort","a","b","localeCompare","key","header","thead","trows","api","text","function","RestInfo","apilist","forEach","item","functions","push","mountUpdate","fun","information","join","RestExecute","JSON","stringify","op","FileList","loadFiles","hasOwnProperty","mode","directory","files","undefined","fullpath","status","alert","substr","length","src","path","alt","className","styles","href","target","rel"],"mappings":"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","file":"static/js/23.8f89b073.chunk.js","sourcesContent":["import React, { Component } from 'react'\nimport { post_call } from './infra/Functions.js';\nimport { RimsContext, Title, Spinner, Article, CodeArticle, ContentReport, ContentList, ContentData } from './infra/UI.jsx';\nimport { HrefButton } from './infra/Buttons.jsx';\nimport { NavBar, NavButton, NavDropDown, NavDropButton, NavInfo, NavReload } from './infra/Navigation.jsx';\n\nimport styles from './infra/ui.module.css';\n\n// ************** Main **************\n//\nexport class Main extends Component {\n constructor(props){\n  super(props)\n  this.state = {navinfo:[], navitems:[], logs:[] }\n }\n\n componentDidMount(){\n  post_call('api/system/inventory',{user_id:this.context.settings.id}).then(result => {\n   Object.assign(this.state,result)\n   this.compileNavItems()\n  })\n }\n\n componentDidUpdate(prevProps){\n  if(prevProps !== this.props)\n   this.compileNavItems();\n }\n\n compileNavItems = () => {\n  const master = (this.context.settings.node === 'master');\n  const admin = (this.context.settings.class === 'admin');\n  const master_admin = (master && admin);\n  this.context.loadNavigation(<NavBar key='system_navbar'>\n   {master_admin && <NavButton key='sys_nav_node' title='Nodes' onClick={() => this.changeImport('node','List')} />}\n   {master_admin && <NavButton key='sys_nav_srv' title='Servers' onClick={() => this.changeImport('server','List')} />}\n   {master && <NavButton key='sys_nav_erd' title='ERD'     onClick={() => window.open('erd.pdf','_blank')} />}\n   {master_admin && <NavButton key='sys_nav_user' title='Users'  onClick={() => this.changeImport('user','List')} />}\n   {master && <NavButton key='sys_nav_ctrl' title='Controls' onClick={() => this.changeContent(<Controls key='system_controls' />)} />}\n   <NavDropDown key='sys_nav_reports' title='Reports'>\n    <NavDropButton key='sys_nav_sys' title='System' onClick={() => this.changeContent(<Report key='system_report' />)} />\n    {admin && <NavDropButton key='sys_nav_act' title='Activities' onClick={() => this.changeImport('activity','Report')} />}\n    {master && <NavDropButton key='sys_nav_resv' title='Reservations' onClick={() => this.changeImport('reservation','Report')} />}\n    {master && <NavDropButton key='sys_nav_dev' title='Devices' onClick={() => this.changeImport('device','Report')} />}\n    {master && <NavDropButton key='sys_nav_if' title='Interfaces' onClick={() => this.changeImport('interface','Report')} />}\n    {master && <NavDropButton key='sys_nav_inv' title='Inventory' onClick={() => this.changeImport('inventory','Report')} />}\n   </NavDropDown>\n   <NavButton key='sys_nav_logs' title='Logs' onClick={() => this.changeImport('node','LogShow',{node:this.context.settings.node})} />\n   {admin && <NavButton key='sys_nav_rest' title='REST' onClick={() => this.changeContent(<RestList key='rest_list' />)} />}\n   <NavReload key='sys_nav_reload' onClick={() => this.changeContent(null)} />\n   {this.state.navinfo.map((row,idx) => <NavInfo key={'sys_nav_ni_'+idx} title={row} />)}\n  </NavBar>)\n }\n\n changeContent = (elem) => this.setState({content:elem})\n\n changeImport(module,func,args){\n  import('./'+module+'.jsx').then(lib => {\n   var Elem = lib[func];\n   this.setState({content:<Elem key={module+'_'+func} {...args} />})\n  })\n }\n\n render(){\n  return <>{this.state.content}</>\n }\n}\nMain.contextType = RimsContext;\n\n// ************** Report **************\n//\nexport class Report extends Component{\n constructor(props){\n  super(props)\n  this.state = {}\n }\n\n componentDidMount(){\n  post_call('api/system/report').then(result => this.setState({data:Object.keys(result).sort((a,b) => a.localeCompare(b)).map(key => ({info:key,value:result[key]})) }))\n }\n\n listItem = (row) => [row.info,row.value]\n\n render(){\n  return <ContentReport key='sys_cr' header='System Report' thead={['Key','Value']} trows={this.state.data} listItem={this.listItem} />\n }\n}\n\n// ************** RestList **************\n//\nclass RestList extends Component {\n constructor(props){\n  super(props);\n  this.state = {}\n }\n\n componentDidMount(){\n  post_call('api/system/rest_explore')\n   .then((result) => {\n    var apilist = [];\n    result.data.forEach(item => item.functions.forEach(row => apilist.push({api:item.api, function:row})  ) );\n    this.setState({data:apilist});\n   })\n }\n\n listItem = (row) => [row.api,<HrefButton key={'rest_' + row.api} text={row.function} onClick={() => { this.changeContent(<RestInfo key='rest_info' {...row} />)}} />]\n\n render(){\n  return <>\n   <ContentList key='cl' header='REST API' thead={['API','Function']} trows={this.state.data} listItem={this.listItem} />\n   <ContentData key='cda' mountUpdate={(fun) => this.changeContent = fun} />\n  </>\n }\n}\n\n// ************** RestInfo **************\n//\nclass RestInfo extends Component {\n constructor(props){\n  super(props)\n  this.state = {}\n }\n\n componentDidUpdate(prevProps) {\n  if (prevProps !== this.props){\n   post_call('api/system/rest_information',{api:this.props.api, function:this.props.function}).then(result => this.setState(result))\n  }\n }\n\n componentDidMount(){\n  post_call('api/system/rest_information',{api:this.props.api, function:this.props.function}).then(result => this.setState(result))\n }\n\n render() {\n  if (this.state.module && this.state.information) {\n   return(\n    <Article key='ri_art' header={this.props.api}>\n     {this.state.module.join('\\n')}\n     <Title text={this.props.function} />\n     {this.state.information.join('\\n')}\n    </Article>\n   )\n  } else\n   return <Spinner />\n }\n}\n\n// ************************ REST Execute ********************\n//\nclass RestExecute extends Component {\n componentDidMount(){\n  post_call('api/' + this.props.api,this.props.args).then(result => this.setState(result))\n }\n\n render(){\n  return (this.state) ? <CodeArticle key='re_code' header={this.props.text}>{JSON.stringify(this.state,null,2)}</CodeArticle> : <Spinner />\n }\n}\n\n// ************************ Controls ********************\n//\n// TODO: List should be dynamic from config and passed through REST engine\nclass Controls extends Component {\n constructor(props){\n  super(props);\n  this.state = {data:[\n   {api:'ipam/address_events',text:'IPAM clear all status logs',args:{op:'clear'}},\n   {api:'device/log_clear',text:'Device clear all status logs'},\n   {api:'ipam/check',text:'IPAM status check'},\n   {api:'interface/check',text:'Interface status check'},\n   {api:'device/system_info_discover',text:'Discover device system information (sysmac etc)'},\n   {api:'device/model_sync',text:'Sync device model mapping'},\n   {api:'device/vm_mapping',text:'VM UUID mapping'},\n   {api:'master/oui_fetch',text:'Sync OUI database'},\n   {api:'reservation/expiration_status',text:'Check reservation status'},\n   {api:'fdb/check',text:'Update FDB'}\n  ]}\n }\n\n listItem = (row) => [<HrefButton key={'ctrl_' + row.api} text={row.text} onClick={() => this.changeContent(<RestExecute key={'rest_' + row.api} {...row} />)} />]\n\n render(){\n  return <>\n   <ContentList key='cl' header='' thead={['API']} trows={this.state.data} listItem={this.listItem} />\n   <ContentData key='cda' mountUpdate={(fun) => this.changeContent = fun} />\n  </>\n }\n}\n\n// ************** File List **************\n//\nexport class FileList extends Component {\n constructor(props){\n  super(props)\n  this.state = {}\n }\n\n componentDidUpdate(prevProps){\n  if (prevProps !== this.props)\n   this.loadFiles();\n }\n\n componentDidMount(){\n  this.loadFiles()\n }\n\n loadFiles = () => {\n  let state = {};\n  if (this.props.hasOwnProperty('directory'))\n   state = {mode:'directory',args:{directory:this.props.directory},files:undefined}\n  else if (this.props.hasOwnProperty('fullpath'))\n   state = {mode:'fullpath',args:{fullpath:this.props.fullpath},files:undefined}\n  else\n   state = {mode:'images',args:{},files:undefined}\n  post_call('api/system/file_list',state.args).then(result => {\n   if (result.status === 'OK')\n    this.setState({mode:state.mode,...result})\n   else {\n    window.alert('Error retrieving files:' + result.info);\n    this.setState({files:[]})\n   }\n  })\n }\n\n listItem = (row) => {\n  if (this.state.mode === 'images')\n   return (row.substr(row.length - 4) === '.png') ? [row,<img src={this.state.path +'/'+row} alt={this.state.path +'/'+row} />] : []\n  else\n   return [<>{this.state.path + '/'}<a className={styles.href} href={this.state.path + '/' + row} target='_blank' rel='noopener noreferrer'>{row}</a></>]\n }\n\n render() {\n  return (!this.state.files) ? <Spinner /> : <ContentReport header={this.state.mode} thead={[]} trows={this.state.files} listItem={this.listItem} />\n }\n}\n"],"sourceRoot":""}