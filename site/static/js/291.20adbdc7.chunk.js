"use strict";(self.webpackChunkrims_frontend=self.webpackChunkrims_frontend||[]).push([[291],{291:(t,e,s)=>{s.r(e),s.d(e,{Main:()=>d});var i=s(43),a=s(524),n=s(662),o=s(97),r=s(728),l=s(579);class d extends i.Component{constructor(t){super(t),this.reloadList=()=>(0,a.Cc)("api/multimedia/list",{},{"X-Route":this.node}).then(t=>this.setState(t)),this.deleteList=t=>window.confirm("Delete file "+t.file+"?")&&(0,a.Cc)("api/multimedia/delete",t,{"X-Route":this.node}).then(e=>{e.deleted&&(this.setState({data:this.state.data.filter(e=>!(e.path===t.path&&e.file===t.file))}),this.changeContent(null))}),this.listItem=(t,e)=>[t.file,(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.InfoButton,{onClick:()=>this.changeContent((0,l.jsx)(h,{path:t.path,file:t.file,node:this.node},"multimedia_title_"+e)),title:"Title info"},"info"),(0,l.jsx)(r.SearchButton,{onClick:()=>this.changeContent((0,l.jsx)(p,{path:t.path,file:t.file,node:this.node},"multimedia_lookup_"+e)),title:"Lookup info"},"lookup"),(0,l.jsx)(r.DocButton,{onClick:()=>this.changeContent((0,l.jsx)(m,{path:t.path,file:t.file,node:this.node},"multimedia_subs_"+e)),title:"Subtitles"},"subs"),(0,l.jsx)(r.DeleteButton,{onClick:()=>this.deleteList(t),title:"Delete file"},"del")]})],this.state={},this.node=this.props.node?this.props.node:this.context.settings.node}componentDidMount(){this.reloadList()}componentDidUpdate(t){t!==this.props&&(this.node=this.props.node?this.props.node:this.context.settings.node)}render(){return this.state.data?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.ContentList,{header:"Media files",thead:["File",""],trows:this.state.data,listItem:this.listItem,result:this.state.result,children:[(0,l.jsx)(r.ReloadButton,{onClick:()=>this.reloadList()},"reload"),(0,l.jsx)(r.DeleteButton,{onClick:()=>window.confirm("Really clean up files?")&&this.changeContent((0,l.jsx)(u,{node:this.node},"multimedia_cleanup")),title:"Cleanup multimedia directory"},"cleanup")]},"cl"),(0,l.jsx)(n.ContentData,{mountUpdate:t=>this.changeContent=t},"cda")]}):(0,l.jsx)(n.Spinner,{})}}d.contextType=n.RimsContext;class h extends i.Component{constructor(t){super(t),this.onChange=t=>this.setState({data:{...this.state.data,[t.target.name]:t.target.value}}),this.threadChange=t=>this.setState({[t.target.name]:t.target.checked}),this.updateInfo=()=>(0,a.Cc)("api/multimedia/check_title",{op:"update",...this.state.data},{"X-Route":this.props.node}).then(t=>this.setState(t)),this.transferFile=()=>{window.confirm("Transfer file to repository?")&&(this.state.thread?(0,a.Cc)("api/system/worker",{module:"multimedia",function:"transfer",output:!0,args:{path:this.props.path,file:this.props.file}},{"X-Route":this.props.node}).then(t=>this.setState({op:"transfer",result:t})):(this.setState({wait:(0,l.jsx)(n.Spinner,{})}),(0,a.Cc)("api/multimedia/transfer",{path:this.props.path,file:this.props.file},{"X-Route":this.props.node}).then(t=>this.setState({op:"transfer",result:t,wait:null}))))},this.processFile=()=>{window.confirm("Process file?")&&(this.state.thread?(0,a.Cc)("api/system/worker",{module:"multimedia",function:"process",output:!0,args:{path:this.props.path,file:this.props.file,...this.state.data}},{"X-Route":this.props.node}).then(t=>this.setState({op:"process",result:t})):(this.setState({wait:(0,l.jsx)(n.Spinner,{})}),(0,a.Cc)("api/multimedia/process",{path:this.props.path,file:this.props.file,...this.state.data},{"X-Route":this.props.node}).then(t=>this.setState({op:"process",result:t,wait:null}))))},this.state={thread:!0,wait:null}}componentDidMount(){(0,a.Cc)("api/multimedia/check_title",{path:this.props.path,file:this.props.file},{"X-Route":this.props.node}).then(t=>this.setState(t))}render(){if(this.state.op){if(this.state.thread||"transfer"===this.state.op)return(0,l.jsx)(n.InfoArticle,{header:this.state.thread?"Task activation":"Transfer",children:(0,l.jsx)(o.TextLine,{id:"result",text:JSON.stringify(this.state.result)},"mm_trans_res")},"mm_trans_article");if("NOT_OK"===this.state.result.status)return(0,l.jsx)(n.CodeArticle,{header:"Process Error",children:JSON.stringify(this.state.result.info,null,2)},"mm_error_code");{const t=this.state.result.data;return(0,l.jsxs)(n.InfoArticle,{header:"Process success",children:["Elapsed time for processing file: ",this.state.result.seconds," seconds",(0,l.jsxs)(n.InfoColumns,{children:[(0,l.jsx)(o.TextLine,{id:"prefix",text:t.prefix},"mm_proc_prefix"),(0,l.jsx)(o.TextLine,{id:"suffix",text:t.suffix},"mm_proc_suffix"),(0,l.jsx)(o.TextLine,{id:"dest",label:"Destination",text:JSON.stringify(t.dest)},"mm_proc_dest"),(0,l.jsx)(o.TextLine,{id:"rename",text:JSON.stringify(t.rename)},"mm_proc_rename"),(0,l.jsx)(o.TextLine,{id:"aac",label:"Add AAC",text:JSON.stringify(t.aac_probe)},"mm_proc_aac"),(0,l.jsx)(o.TextLine,{id:"chg_aac",label:"Param AAC",text:t.changes.aac},"mm_proc_chg_aac"),(0,l.jsx)(o.TextLine,{id:"chg_aud",label:"Param Audio",text:t.changes.audio},"mm_proc_chg_aud"),(0,l.jsx)(o.TextLine,{id:"chg_sub",label:"Param Subtitles",text:t.changes.subtitle},"mm_proc_chg_sub"),(0,l.jsx)(o.TextLine,{id:"chg_srt",label:"Param SRT files",text:t.changes.srt},"mm_proc_chg_srt")]},"mm_proc_ic")]},"mm_proc_article")}}if(this.state.data){const t=this.state.data;return(0,l.jsxs)(n.InfoArticle,{header:"Title",children:[(0,l.jsxs)(n.InfoColumns,{children:[(0,l.jsx)(o.TextLine,{id:"type",text:t.type},"mm_tit_type"),(0,l.jsx)(o.TextLine,{id:"title",text:t.title},"mm_tit_title"),(0,l.jsx)(o.TextLine,{id:"path",text:t.path},"mm_tit_path"),(0,l.jsx)(o.TextInput,{id:"name",value:t.name,onChange:this.onChange},"mm_tit_name"),t.epside&&(0,l.jsx)(o.TextInput,{id:"episode",value:t.episode,onChange:this.onChange},"mm_tit_eposide"),(0,l.jsx)(o.TextInput,{id:"info",value:t.info,onChange:this.onChange},"mm_tit_info"),(0,l.jsx)(o.CheckboxInput,{id:"thread",label:"Thread",value:this.state.thread,onChange:this.threadChange,title:"Thread or direct execution"},"mm_tit_thread")]},"mm_tit_ic"),(0,l.jsx)(r.StartButton,{onClick:()=>this.processFile(),title:"Process file"},"mm_tit_btn_proc"),(0,l.jsx)(r.SyncButton,{onClick:()=>this.transferFile(),title:"Transfer file"},"mm_tit_btn_trans"),this.state.wait]},"mm_tit_article")}return(0,l.jsx)(n.Spinner,{})}}class p extends i.Component{constructor(t){super(t),this.state={}}componentDidMount(){(0,a.Cc)("api/multimedia/check_content",{path:this.props.path,file:this.props.file},{"X-Route":this.props.node}).then(t=>this.setState(t))}render(){if(this.state.data){const t=this.state.data;return(0,l.jsx)(n.InfoArticle,{header:"Lookup",children:(0,l.jsxs)(n.InfoColumns,{children:[(0,l.jsx)(o.TextLine,{id:"file",label:"File",text:this.props.file},"mm_lu_file"),(0,l.jsx)(o.TextLine,{id:"status",label:"Result",text:this.state.status},"mm_lu_status"),(0,l.jsx)(o.TextLine,{id:"error",label:"Error",text:this.state.info},"mm_lu_error"),(0,l.jsx)(o.TextLine,{id:"video_default",label:"Video default",text:JSON.stringify(!t.video.set_default),title:"Video stream has default language"},"mm_lu_v_def"),(0,l.jsx)(o.TextLine,{id:"video_lang",label:"Video language",text:t.video.language,title:"Language set in video stream information"},"mm_lu_v_lang"),(0,l.jsx)(o.TextLine,{id:"audio_add",label:"Audio keep",text:t.audio.add.join()},"mm_lu_a_add"),(0,l.jsx)(o.TextLine,{id:"audio_rem",label:"Audio remove",text:t.audio.remove.join()},"mm_lu_a_rem"),(0,l.jsx)(o.TextLine,{id:"audio_aac",label:"Add AAC",text:JSON.stringify(t.audio.add_aac)},"mm_lu_a_aac"),(0,l.jsx)(o.TextLine,{id:"sub_add",label:"Subtitle keep",text:t.subtitle.add.join()},"mm_lu_s_add"),(0,l.jsx)(o.TextLine,{id:"sub_rem",label:"Subtitle remove",text:t.subtitle.remove.join()},"mm_lu_s_rem"),(0,l.jsx)(o.TextLine,{id:"sub_lang",label:"Subtitle languages",text:t.subtitle.languages.join()},"mm_lu_a_lang")]},"mm_lu_ic")},"mm_lu_article")}return(0,l.jsx)(n.Spinner,{})}}class m extends i.Component{constructor(t){super(t),this.state={}}componentDidMount(){(0,a.Cc)("api/multimedia/check_srt",{path:this.props.path,file:this.props.file},{"X-Route":this.props.node}).then(t=>this.setState(t))}render(){return this.state.data?(0,l.jsx)(n.InfoArticle,{header:"Extra subtitles",children:(0,l.jsxs)(n.InfoColumns,{children:[(0,l.jsx)(o.TextLine,{id:"path",text:this.props.path},"mm_sub_path"),(0,l.jsx)(o.TextLine,{id:"item",text:this.props.file},"mm_sub_item"),(0,l.jsx)(o.TextLine,{id:"name",text:this.state.data.name},"mm_sub_name"),(0,l.jsx)(o.TextLine,{id:"code",text:this.state.data.code},"mm_sub_code"),(0,l.jsx)(o.TextLine,{id:"file",text:this.state.data.file},"mm_sub_file")]},"mm_sub_ic")},"mm_sub_art"):(0,l.jsx)(n.Spinner,{})}}class u extends i.Component{constructor(t){super(t),this.state={}}componentDidUpdate(t){t!==this.props&&this.componentDidMount()}componentDidMount(){(0,a.Cc)("api/multimedia/cleanup",{},{"X-Route":this.props.node}).then(t=>this.setState(t))}render(){return this.state.data?(0,l.jsx)(n.ContentReport,{header:"delete",thead:["Type","Path","Item","Status","Info"],trows:this.state.data,listItem:t=>[t.type,t.path,t.item,t.status,t.info]},"mm_clean_cr"):(0,l.jsx)(n.Spinner,{})}}}}]);
//# sourceMappingURL=291.20adbdc7.chunk.js.map