"use strict";(self.webpackChunkrims_frontend=self.webpackChunkrims_frontend||[]).push([[587],{587:(t,e,s)=>{s.r(e),s.d(e,{List:()=>p});var i=s(43),n=s(524),a=s(662),o=s(307),r=s(97),d=s(728),h=s(579);class p extends i.Component{constructor(t){super(t),this.listItem=t=>[t.node,t.service,t.type,(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(d.InfoButton,{onClick:()=>this.changeContent((0,h.jsx)(c,{id:t.id},"server_info")),title:"Service information"},"info"),(0,h.jsx)(d.DeleteButton,{onClick:()=>this.deleteList(t.id),title:"Delete service"},"del"),t.hasOwnProperty("ui")&&t.ui.length>0&&(0,h.jsx)(d.UiButton,{onClick:()=>window.open(t.ui,"_blank"),title:"Server UI"},"ui")]})],this.deleteList=t=>window.confirm("Really delete service?")&&(0,n.Cc)("api/master/server_delete",{id:t}).then(e=>{e.deleted&&(this.setState({data:this.state.data.filter(e=>e.id!==t)}),this.changeContent(null))}),this.state={}}componentDidMount(){(0,n.Cc)("api/master/server_list",{type:this.props.type}).then(t=>this.setState(t))}componentDidUpdate(t){t!==this.props&&(0,n.Cc)("api/master/server_list",{type:this.props.type}).then(t=>this.setState(t))}render(){return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(a.ContentList,{header:"Servers",thead:["Node","Service","Type",""],trows:this.state.data,listItem:this.listItem,children:[(0,h.jsx)(d.ReloadButton,{onClick:()=>this.componentDidMount()},"reload"),(0,h.jsx)(d.AddButton,{onClick:()=>this.changeContent((0,h.jsx)(c,{id:"new",type:this.props.type},"server_info")),title:"Add service"},"add")]},"cl"),(0,h.jsx)(a.ContentData,{mountUpdate:t=>this.changeContent=t},"cda")]})}}class c extends i.Component{constructor(t){super(t),this.changeContent=t=>this.setState({content:t}),this.onChange=t=>this.setState({data:{...this.state.data,[t.target.name]:t.target.value}}),this.updateInfo=()=>(0,n.Cc)("api/master/server_info",{op:"update",...this.state.data}).then(t=>this.setState(t)),this.state={data:null,found:!0}}componentDidUpdate(t){t!==this.props&&this.componentDidMount()}componentDidMount(){(0,n.Cc)("api/master/server_info",{id:this.props.id}).then(t=>{t.data.node||(t.data.node=t.nodes[0]),t.data.type_id||(t.data.type_id=t.services[0].id),this.setState({...t,content:null})})}render(){if(this.state.found){if(this.state.data){const t=this.state.data.id,e="new"!==t;return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(a.InfoArticle,{header:"Server",children:[(0,h.jsxs)(a.InfoColumns,{children:[(0,h.jsx)(r.TextLine,{id:"server",label:"ID",text:t},"server"),(0,h.jsx)(r.SelectInput,{id:"node",value:this.state.data.node,onChange:this.onChange,children:this.state.nodes.map(t=>(0,h.jsx)("option",{value:t,children:t},t))},"node"),(0,h.jsx)(r.SelectInput,{id:"type_id",label:"Service",value:this.state.data.type_id,onChange:this.onChange,children:this.state.services.map(t=>(0,h.jsx)("option",{value:t.id,children:`${t.service} (${t.type})`},t.id))},"type_id"),(0,h.jsx)(r.UrlInput,{id:"ui",label:"UI",value:this.state.data.ui,onChange:this.onChange},"ui")]},"ic"),(0,h.jsx)(d.SaveButton,{onClick:()=>this.updateInfo(),title:"Save"},"save"),e&&(0,h.jsx)(d.SyncButton,{onClick:()=>this.changeContent((0,h.jsx)(l,{id:t,operation:"sync"},"srv_op_sync")),title:"Sync service"},"sync"),e&&(0,h.jsx)(d.ReloadButton,{onClick:()=>this.changeContent((0,h.jsx)(l,{id:t,operation:"restart"},"srv_op_rst")),title:"Restart service"},"restart"),e&&(0,h.jsx)(d.CheckButton,{onClick:()=>this.changeContent((0,h.jsx)(l,{id:t,operation:"parameters"},"srv_op_params")),title:"Service parameters"},"params"),e&&(0,h.jsx)(d.SearchButton,{onClick:()=>this.changeContent((0,h.jsx)(l,{id:t,operation:"status"},"srv_op_stat")),title:"Service status"},"status"),e&&(0,h.jsx)(d.StartButton,{onClick:()=>this.changeContent((0,h.jsx)(l,{id:t,operation:"start"},"srv_op_start")),title:"Start service"},"start"),e&&(0,h.jsx)(d.StopButton,{onClick:()=>this.changeContent((0,h.jsx)(l,{id:t,operation:"stop"},"srv_op_stop")),title:"Stop service"},"stop")]},"ia"),(0,h.jsx)(o.NavBar,{id:"server_navigation"},"server_navigation"),this.state.content]})}return(0,h.jsx)(a.Spinner,{})}return(0,h.jsxs)(a.InfoArticle,{children:["Server with id: ",this.props.id," removed"]},"si_art_nf")}}class l extends i.Component{constructor(t){super(t),this.state={wait:!0}}componentDidMount(){(0,n.Cc)("api/master/server_operation",{op:this.props.operation,id:this.props.id}).then(t=>this.setState({result:t,wait:!1}))}componentDidUpdate(t){t!==this.props&&(this.setState({wait:!0}),this.componentDidMount())}render(){return this.state.wait?(0,h.jsx)(a.Spinner,{}):(0,h.jsx)(a.CodeArticle,{children:JSON.stringify(this.state.result,null,2)},"srv_operation")}}}}]);
//# sourceMappingURL=587.c0ae3c87.chunk.js.map