"use strict";(self.webpackChunkrims_frontend=self.webpackChunkrims_frontend||[]).push([[749],{749:function(t,e,n){n.r(e),n.d(e,{DomainList:function(){return x},Main:function(){return v}});var i=n(37),a=n(942),r=n(413),o=n(671),s=n(144),u=n(340),d=n(882),c=n(791),l=n(252),h=n(885),p=n(698),f=n(682),m=n(184),v=function(t){(0,u.Z)(n,t);var e=(0,d.Z)(n);function n(){var t;(0,o.Z)(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(t=e.call.apply(e,[this].concat(a))).changeContent=function(e){return t.setState(e)},t}return(0,s.Z)(n,[{key:"componentDidMount",value:function(){this.setState((0,m.jsx)(x,{},"domain_list"))}},{key:"render",value:function(){return(0,m.jsx)(m.Fragment,{children:this.state})}}]),n}(c.Component),x=function(t){(0,u.Z)(n,t);var e=(0,d.Z)(n);function n(t){var i;return(0,o.Z)(this,n),(i=e.call(this,t)).listItem=function(t){return[t.id,t.name,t.service,(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(f.ConfigureButton,{onClick:function(){return i.changeContent((0,m.jsx)(C,{id:t.id},"domain_info"))},title:"Edit domain information"},"info"),(0,m.jsx)(f.ItemsButton,{onClick:function(){return i.changeContent((0,m.jsx)(j,{changeSelf:i.changeContent,domain_id:t.id},"record_list"))},title:"View domain records"},"items"),(0,m.jsx)(f.DeleteButton,{onClick:function(){return i.deleteList(t.id)},title:"Delete domain"},"del")]})]},i.changeContent=function(t){return i.setState({content:t})},i.deleteList=function(t){return window.confirm("Really delete domain")&&(0,l.Fh)("api/dns/domain_delete",{id:t}).then((function(e){e.deleted&&(i.setState({data:i.state.data.filter((function(e){return e.id!==t}))}),i.changeContent(null))}))},i.state={},i}return(0,s.Z)(n,[{key:"componentDidMount",value:function(){var t=this;(0,l.Fh)("api/dns/domain_list").then((function(e){e.result="OK",t.setState(e)}))}},{key:"syncDomains",value:function(){var t=this;(0,l.Fh)("api/dns/domain_list",{sync:!0}).then((function(e){e.result="NS:"+e.ns.status+", Recursors:"+e.rec.status,t.setState(e)}))}},{key:"render",value:function(){var t=this;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(h.ContentList,{header:"Domains",thead:["ID","Domain","Server",""],trows:this.state.data,listItem:this.listItem,result:this.state.result,children:[(0,m.jsx)(f.ReloadButton,{onClick:function(){return t.componentDidMount()}},"reload"),(0,m.jsx)(f.AddButton,{onClick:function(){return t.changeContent((0,m.jsx)(C,{id:"new"},"domain_info"))},title:"Add domain"},"add"),(0,m.jsx)(f.SyncButton,{onClick:function(){return t.syncDomains()},title:"Sync external DNS servers with cache"},"sync"),(0,m.jsx)(f.HealthButton,{onClick:function(){return t.changeContent((0,m.jsx)(g,{},"recursor_statistics"))},title:"View DNS statistics"},"stats")]},"cl"),(0,m.jsx)(h.ContentData,{mountUpdate:function(e){return t.changeContent=e}},"cda")]})}}]),n}(c.Component),C=function(t){(0,u.Z)(n,t);var e=(0,d.Z)(n);function n(t){var i;return(0,o.Z)(this,n),(i=e.call(this,t)).onChange=function(t){return i.setState({data:(0,r.Z)((0,r.Z)({},i.state.data),{},(0,a.Z)({},t.target.name,t.target.value))})},i.changeContent=function(t){return i.setState({content:t})},i.updateInfo=function(){return(0,l.Fh)("api/dns/domain_info",(0,r.Z)({op:"update"},i.state.data)).then((function(t){return i.setState(t)}))},i.state={data:null},i}return(0,s.Z)(n,[{key:"componentDidUpdate",value:function(t){t!==this.props&&this.componentDidMount()}},{key:"componentDidMount",value:function(){var t=this;(0,l.Fh)("api/dns/domain_info",{id:this.props.id}).then((function(e){return t.setState(e)}))}},{key:"render",value:function(){var t=this;if(this.state.data){var e="new"!==this.state.data.id;return(0,m.jsxs)(h.InfoArticle,{header:"Domain",children:[(0,m.jsxs)(h.InfoColumns,{children:[e&&(0,m.jsx)(p.TextLine,{id:"node",text:this.state.infra.node},"node"),e&&(0,m.jsx)(p.TextLine,{id:"service",text:this.state.infra.service},"service"),e&&(0,m.jsx)(p.TextLine,{id:"foreign_id",label:"Foreign ID",text:this.state.infra.foreign_id},"foreign_id"),!e&&(0,m.jsx)(p.SelectInput,{id:"server_id",label:"Server",value:this.state.data.server_id,onChange:this.onChange,children:this.state.servers.map((function(t,e){return(0,m.jsx)("option",{value:t.id,children:"".concat(t.service,"@").concat(t.node)},"srv_"+e)}))},"server_id"),(0,m.jsx)(p.TextInput,{id:"name",value:this.state.data.name,onChange:this.onChange},"name"),(0,m.jsx)(p.TextInput,{id:"master",value:this.state.data.master,onChange:this.onChange},"master"),(0,m.jsx)(p.TextInput,{id:"type",value:this.state.data.type,onChange:this.onChange},"type"),(0,m.jsx)(p.TextLine,{id:"serial",text:this.state.data.serial},"serial")]},"ic"),(0,m.jsx)(f.SaveButton,{onClick:function(){return t.updateInfo()},title:"Save domain information"},"save")]},"ia_dom")}return(0,m.jsx)(h.Spinner,{})}}]),n}(c.Component),g=function(t){(0,u.Z)(n,t);var e=(0,d.Z)(n);function n(t){var i;return(0,o.Z)(this,n),(i=e.call(this,t)).state={},i}return(0,s.Z)(n,[{key:"componentDidMount",value:function(){var t=this;(0,l.Fh)("api/dns/statistics").then((function(e){for(var n=[],a=function(){var t=(0,i.Z)(o[r],2),e=t[0],a=t[1],s=e.split("_");a.forEach((function(t){return n.push([s[0],s[1],t[0],t[1],t[2]])}))},r=0,o=Object.entries(e.queries);r<o.length;r++)a();for(var s=[],u=function(){var t=(0,i.Z)(c[d],2),e=t[0],n=t[1],a=e.split("_");n.forEach((function(t){return s.push([a[0],a[1],t[0],t[1]])}))},d=0,c=Object.entries(e.remotes);d<c.length;d++)u();t.setState({queries:n,remotes:s})}))}},{key:"render",value:function(){return this.state.queries&&this.state.remotes?(0,m.jsxs)(h.Flex,{children:[(0,m.jsx)(h.ContentReport,{header:"Looked up FQDN",thead:["Node","Service","Hits","FQDN","Type"],trows:this.state.queries,listItem:function(t){return t}},"queries_cr"),(0,m.jsx)(h.ContentReport,{header:"Queriers",thead:["Node","Service","Hits","Who"],trows:this.state.remotes,listItem:function(t){return t}},"remotes_cr")]},"statistics_flex"):(0,m.jsx)(h.Spinner,{})}}]),n}(c.Component),j=function(t){(0,u.Z)(n,t);var e=(0,d.Z)(n);function n(t){var i;return(0,o.Z)(this,n),(i=e.call(this,t)).changeContent=function(t){return i.props.changeSelf(t)},i.listItem=function(t){return[t.name,t.content,t.type,t.ttl,(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(f.ConfigureButton,{onClick:function(){return i.changeContent((0,m.jsx)(_,(0,r.Z)({domain_id:i.props.domain_id,op:"info"},t),"record_info"))},title:"Configure record"},"info"),["A","AAAA","CNAME","PTR"].includes(t.type)&&(0,m.jsx)(f.DeleteButton,{onClick:function(){return i.deleteList(t.name,t.type)},title:"Delete record"},"del")]})]},i.deleteList=function(t,e){return window.confirm("Delete record?")&&(0,l.Fh)("api/dns/record_delete",{domain_id:i.props.domain_id,name:t,type:e}).then((function(n){return n.deleted&&i.setState({data:i.state.data.filter((function(n){return!(n.name===t&&n.type===e)}))})}))},i.state={},i}return(0,s.Z)(n,[{key:"componentDidUpdate",value:function(t){t!==this.props&&this.componentDidMount()}},{key:"componentDidMount",value:function(){var t=this;(0,l.Fh)("api/dns/record_list",{domain_id:this.props.domain_id}).then((function(e){return t.setState(e)}))}},{key:"render",value:function(){var t=this,e=this.state.status;if(e){if("OK"===e){var n=this.state.data;return(0,m.jsxs)(h.ContentReport,{header:"Records",thead:["Name","Content","Type","TTL",""],trows:n,listItem:this.listItem,result:this.state.result,children:[(0,m.jsx)(f.ReloadButton,{onClick:function(){return t.componentDidMount()}},"reload"),(0,m.jsx)(f.AddButton,{onClick:function(){return t.changeContent((0,m.jsx)(_,{domain_id:t.props.domain_id,name:"new",op:"new"},"record_info"))},title:"Add DNS record"},"add")]},"rl_cr")}return(0,m.jsxs)(h.CodeArticle,{children:["Error retrieving record list: ",JSON.stringify(this.state.info)]},"ca_rl")}return(0,m.jsx)(h.Spinner,{})}}]),n}(c.Component),_=function(t){(0,u.Z)(n,t);var e=(0,d.Z)(n);function n(t){var i;return(0,o.Z)(this,n),(i=e.call(this,t)).onChange=function(t){return i.setState({data:(0,r.Z)((0,r.Z)({},i.state.data),{},(0,a.Z)({},t.target.name,t.target.value))})},i.updateInfo=function(){return(0,l.Fh)("api/dns/record_info",(0,r.Z)({op:i.state.op},i.state.data)).then((function(t){i.setState((0,r.Z)({op:"OK"===t.status?"update":i.state.op},t))}))},i.state={data:null,info:void 0},"info"===i.props.op?(i.state.data={domain_id:i.props.domain_id,name:i.props.name,type:i.props.type,ttl:i.props.ttl,content:i.props.content},i.state.op="update"):(i.state.data={domain_id:i.props.domain_id,name:"",type:"A",ttl:3600,content:""},i.state.op="insert"),i}return(0,s.Z)(n,[{key:"render",value:function(){var t=this;return this.state.data?(0,m.jsxs)(h.InfoArticle,{header:"Record",children:[(0,m.jsxs)(h.InfoColumns,{children:[(0,m.jsx)(p.TextInput,{id:"name",value:this.state.data.name,title:"E.g. A:FQDN, PTR:x.y.z.in-addr.arpa",onChange:this.onChange,placeholder:"name"},"name"),(0,m.jsx)(p.TextInput,{id:"type",value:this.state.data.type,onChange:this.onChange,placeholder:"A, PTR or CNAME typically"},"type"),(0,m.jsx)(p.TextInput,{id:"ttl",label:"TTL",value:this.state.data.ttl,onChange:this.onChange},"ttl"),(0,m.jsx)(p.TextInput,{id:"content",value:this.state.data.content,title:"E.g. A:IP, PTR:x.y.x-inaddr.arpa, CNAME:A - remember dot on PTR/CNAME",onChange:this.onChange,placeholder:"content"},"content"),this.props.serial&&(0,m.jsx)(p.TextLine,{id:"serial",text:this.props.serial},"serial")]},"ic"),(0,m.jsx)(f.SaveButton,{onClick:function(){return t.updateInfo()},title:"Save record information"},"save"),(0,m.jsx)(h.Result,{result:"OK"!==this.state.status?JSON.stringify(this.state.info):"OK"},"result")]},"rec_art"):(0,m.jsx)(h.Spinner,{})}}]),n}(c.Component)}}]);
//# sourceMappingURL=749.abcf1aee.chunk.js.map