"use strict";(self.webpackChunkrims_frontend=self.webpackChunkrims_frontend||[]).push([[546],{546:(t,e,i)=>{i.r(e),i.d(e,{List:()=>h,Report:()=>l});var s=i(43),n=i(524),a=i(662),d=i(728),o=i(97),r=i(579);class h extends s.Component{constructor(t){super(t),this.extendItem=(t,e,i)=>{(0,n.Cc)("api/reservation/extend",{device_id:t,user_id:e,days:i}).then((t=>this.componentDidMount()))},this.deleteItem=(t,e)=>window.confirm("Remove reservation?")&&(0,n.Cc)("api/reservation/delete",{device_id:t,user_id:e}).then((e=>{e.deleted&&(this.setState({data:this.state.data.filter((e=>e.device_id!==t))}),this.changeContent(null))})),this.listItem=t=>{const e=this.context.settings.id===t.user_id||!t.valid;return[t.alias,t.hostname,t.end,(0,r.jsxs)(r.Fragment,{children:[e&&(0,r.jsx)(d.InfoButton,{onClick:()=>{this.changeContent((0,r.jsx)(c,{device_id:t.device_id,user_id:t.user_id},"rsv_device_"+t.device_id))},title:"Info"},"info"),e&&(0,r.jsx)(d.AddButton,{onClick:()=>{this.extendItem(t.device_id,t.user_id,14)},title:"Extend reservation"},"ext"),e&&(0,r.jsx)(d.DeleteButton,{onClick:()=>{this.deleteItem(t.device_id,t.user_id)},title:"Remove reservation"},"del")]})]},this.state={}}componentDidMount(){(0,n.Cc)("api/reservation/list").then((t=>this.setState(t)))}render(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(a.ContentList,{header:"Reservations",thead:["User","Device","Until",""],trows:this.state.data,listItem:this.listItem,children:[(0,r.jsx)(d.ReloadButton,{onClick:()=>this.componentDidMount()},"reload"),(0,r.jsx)(d.AddButton,{onClick:()=>this.changeContent((0,r.jsx)(v,{},"rsv_new"))},"add")]},"cl"),(0,r.jsx)(a.ContentData,{mountUpdate:t=>this.changeContent=t},"cda")]})}}h.contextType=a.RimsContext;class c extends s.Component{constructor(t){super(t),this.onChange=t=>this.setState({data:{...this.state.data,[t.target.name]:t.target.value}}),this.updateInfo=()=>(0,n.Cc)("api/reservation/info",{op:"update",...this.state.data}).then((t=>this.setState(t))),this.extendItem=t=>{(0,n.Cc)("api/reservation/extend",{device_id:this.state.data.device_id,user_id:this.state.data.user_id,days:t}).then((t=>"OK"===t.status&&this.componentDidMount()))},this.state={data:null,found:!0}}componentDidMount(){(0,n.Cc)("api/reservation/info",{device_id:this.props.device_id}).then((t=>this.setState(t)))}render(){return this.state.data?(0,r.jsxs)(a.InfoArticle,{header:"Reservation",children:[(0,r.jsxs)(a.InfoColumns,{children:[(0,r.jsx)(o.TextLine,{id:"alias",text:this.state.data.alias},"alias"),(0,r.jsx)(o.TextLine,{id:"Start",text:this.state.data.time_start},"time_start"),(0,r.jsx)(o.TextLine,{id:"End",text:this.state.data.time_end},"time_end"),(0,r.jsx)(o.RadioInput,{id:"shutdown",value:this.state.data.shutdown,options:[{text:"no",value:"no"},{text:"yes",value:"yes"},{text:"reset",value:"reset"}],onChange:this.onChange},"shutdown"),(0,r.jsx)(o.TextInput,{id:"info",value:this.state.data.info,onChange:this.onChange},"info")]},"reservation_content"),this.state.data.user_id===this.context.settings.id&&(0,r.jsx)(d.SaveButton,{onClick:()=>this.updateInfo(),title:"Save"},"rsv_btn_save"),this.state.data.user_id===this.context.settings.id&&(0,r.jsx)(d.AddButton,{onClick:()=>this.extendItem(14),title:"Extend"},"rsv_btn_extend")]},"rsv_article"):(0,r.jsx)(a.Spinner,{})}}c.contextType=a.RimsContext;class v extends s.Component{constructor(t){super(t),this.onChange=t=>{this.setState({device:t.target.value})},this.findDevice=()=>(0,n.Cc)("api/device/search",{hostname:this.state.device}).then((t=>t.found&&this.setState({device_id:t.data.id,matching:t.data.hostname}))),this.reserveDevice=()=>(0,n.Cc)("api/reservation/new",{device_id:this.state.device_id,user_id:this.context.settings.id}).then((t=>"OK"===t.status&&this.setState({device:"",device_id:void 0,matching:""}))),this.state={device:"",device_id:void 0,matching:""}}render(){return(0,r.jsxs)(a.LineArticle,{header:"New reservation",children:[(0,r.jsx)(o.TextInput,{id:"device",label:"Search device",onChange:this.onChange,value:this.state.device,placeholder:"search"},"device")," found ",(0,r.jsx)(o.TextLine,{id:"matching device",text:this.state.matching},"matching"),this.state.device&&(0,r.jsx)(d.SearchButton,{onClick:()=>this.findDevice(),title:"Find device"},"rsv_btn_search"),this.state.device_id&&(0,r.jsx)(d.AddButton,{onClick:()=>this.reserveDevice(),title:"Reserve device"},"rsv_btn_new")]},"rsv_art")}}v.contextType=a.RimsContext;class l extends s.Component{constructor(t){super(t),this.listItem=t=>[t.alias,t.hostname,t.start,t.end,t.info],this.state={}}componentDidMount(){(0,n.Cc)("api/reservation/list",{extended:!0}).then((t=>this.setState(t)))}render(){return(0,r.jsx)(a.ContentReport,{header:"Reservations",thead:["User","Device","Start","End","Info"],trows:this.state.data,listItem:this.listItem},"rsv_cr")}}}}]);
//# sourceMappingURL=546.930ebc2e.chunk.js.map