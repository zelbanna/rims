(this.webpackJsonprims=this.webpackJsonprims||[]).push([[12],{46:function(t,e,n){"use strict";n.r(e),n.d(e,"Main",(function(){return f})),n.d(e,"Report",(function(){return C}));var a=n(18),i=n(14),r=n(3),c=n(4),o=n(5),l=n(6),u=n(0),s=n.n(u),d=n(12),y=n(13),p=n(15),m=n(19),h=n(16),f=function(t){Object(l.a)(Main,t);var e=Object(o.a)(Main);function Main(t){var n;return Object(r.a)(this,Main),(n=e.call(this,t)).compileNavItems=function(){return n.context.loadNavigation(s.a.createElement(h.NavBar,{key:"activity_navbar"},s.a.createElement(h.NavDropDown,{key:"act_nav",title:"Activities"},s.a.createElement(h.NavDropButton,{key:"act_nav_new",title:"New",onClick:function onClick(){return n.changeContent(s.a.createElement(_,{key:"activity_info",id:"new"}))}}),s.a.createElement(h.NavDropButton,{key:"act_nav_day",title:"Daily",onClick:function onClick(){return n.changeContent(s.a.createElement(k,{key:"activity_daily",changeSelf:n.changeContent}))}}),s.a.createElement(h.NavDropButton,{key:"act_nav_list",title:"List",onClick:function onClick(){return n.changeContent(s.a.createElement(v,{key:"activity_list"}))}})),s.a.createElement(h.NavButton,{key:"act_nav_types",title:"Types",onClick:function onClick(){return n.changeContent(s.a.createElement(E,{key:"activity_type_list"}))}}),s.a.createElement(h.NavButton,{key:"act_nav_report",title:"Report",onClick:function onClick(){return n.changeContent(s.a.createElement(C,{key:"activity_report"}))}})))},n.changeContent=function(t){return n.setState(t)},n.state=s.a.createElement(k,{key:"activity_daily",changeSelf:n.changeContent}),n}return Object(c.a)(Main,[{key:"componentDidMount",value:function componentDidMount(){this.compileNavItems()}},{key:"componentDidUpdate",value:function componentDidUpdate(t){t!==this.props&&this.compileNavItems()}},{key:"render",value:function render(){return s.a.createElement(u.Fragment,null,this.state)}}]),Main}(u.Component);f.contextType=y.RimsContext;var v=function(t){Object(l.a)(List,t);var e=Object(o.a)(List);function List(t){var n;return Object(r.a)(this,List),(n=e.call(this,t)).listItem=function(t){return[t.date+" - "+t.time,s.a.createElement(m.HrefButton,{key:"al_btn_hinfo_"+t.id,onClick:function onClick(){return n.changeContent(s.a.createElement(_,{key:"activity_info_"+t.id,id:t.id}))},text:t.type}),s.a.createElement(u.Fragment,null,s.a.createElement(m.InfoButton,{key:"al_btn_info_"+t.id,onClick:function onClick(){return n.changeContent(s.a.createElement(_,{key:"activity_"+t.id,id:t.id}))},title:"Activity information"}),s.a.createElement(m.DeleteButton,{key:"al_btn_delete_"+t.id,onClick:function onClick(){return n.deleteList(t.id)},title:"Delete activity"}))]},n.changeContent=function(t){return n.setState({content:t})},n.deleteList=function(t){return window.confirm("Delete activity")&&Object(d.d)("api/master/activity_delete",{id:t}).then((function(e){return e.deleted&&n.setState({data:n.state.data.filter((function(e){return e.id!==t})),content:null})}))},n.state={searchfield:""},n}return Object(c.a)(List,[{key:"componentDidMount",value:function componentDidMount(){var t=this;Object(d.d)("api/master/activity_list").then((function(e){return t.setState(e)}))}},{key:"render",value:function render(){var t=this;if(this.state.data){var e=0===this.state.searchfield.length?this.state.data:this.state.data.filter((function(e){return e.type.includes(t.state.searchfield)}));return s.a.createElement(u.Fragment,null,s.a.createElement(y.ContentList,{key:"al_cl",header:"Activities",thead:["Date","Type",""],trows:e,listItem:this.listItem},s.a.createElement(m.ReloadButton,{key:"al_btn_reload",onClick:function onClick(){return t.componentDidMount()}}),s.a.createElement(m.AddButton,{key:"al_btn_add",onClick:function onClick(){return t.changeContent(s.a.createElement(_,{key:"activity_new_"+Object(d.e)(),id:"new"}))},title:"Add activity"}),s.a.createElement(p.SearchInput,{key:"al_search",searchFire:function searchFire(e){return t.setState({searchfield:e})},placeholder:"Search activities"})),s.a.createElement(y.ContentData,{key:"al_cd"},this.state.content))}return s.a.createElement(y.Spinner,null)}}]),List}(u.Component),_=function(t){Object(l.a)(Info,t);var e=Object(o.a)(Info);function Info(t){var n;return Object(r.a)(this,Info),(n=e.call(this,t)).onChange=function(t){return n.setState({data:Object(i.a)({},n.state.data,Object(a.a)({},t.target.name,t.target.value))})},n.updateInfo=function(){Object(d.d)("api/master/activity_info",Object(i.a)({op:"update"},n.state.data)).then((function(t){return n.setState(t)}))},n.state={data:null},n}return Object(c.a)(Info,[{key:"componentDidMount",value:function componentDidMount(){var t=this;Object(d.d)("api/master/activity_info",{id:this.props.id,extras:["types","users"]}).then((function(e){null===e.data.user_id&&(e.data.user_id=t.context.settings.id),t.setState(e)}))}},{key:"render",value:function render(){var t=this;return this.state.data?s.a.createElement(y.InfoArticle,{key:"ai_art",header:"Activity"},s.a.createElement(y.InfoColumns,{key:"ai_content"},s.a.createElement(p.TextLine,{key:"ai_id",id:"id",label:"ID",text:this.state.data.id}),s.a.createElement(p.SelectInput,{key:"ai_user_id",id:"user_id",label:"User",value:this.state.data.user_id,onChange:this.onChange},this.state.users.map((function(t,e){return s.a.createElement("option",{key:e,value:t.id},t.alias)}))),s.a.createElement(p.SelectInput,{key:"ai_type_id",id:"type_id",label:"Type",value:this.state.data.type_id,onChange:this.onChange},this.state.types.map((function(t,e){return s.a.createElement("option",{key:e,value:t.id},t.type)}))),s.a.createElement(p.DateInput,{key:"ai_date",id:"date",value:this.state.data.date,onChange:this.onChange}),s.a.createElement(p.TimeInput,{key:"ai_time",id:"time",value:this.state.data.time,onChange:this.onChange})),s.a.createElement(p.TextAreaInput,{key:"ai_event",id:"event",value:this.state.data.event,onChange:this.onChange}),s.a.createElement(m.SaveButton,{key:"ai_btn_save",onClick:function onClick(){return t.updateInfo()},title:"Save"}),s.a.createElement(y.Result,{key:"ai_result",result:JSON.stringify(this.state.update)})):s.a.createElement(y.Spinner,null)}}]),Info}(u.Component);_.contextType=y.RimsContext;var k=function(t){Object(l.a)(Daily,t);var e=Object(o.a)(Daily);function Daily(t){var n;Object(r.a)(this,Daily),(n=e.call(this,t)).changeContent=function(t){return n.props.changeSelf(t)},n.deleteList=function(t){return window.confirm("Delete activity")&&Object(d.d)("api/master/activity_delete",{id:t}).then((function(e){if(e.deleted){var a=n.state.data.findIndex((function(e){return e.act_id===t})),i=n.state.data[a];Object.assign(i,{user_id:null,event:null,act_id:null}),n.setState({data:n.state.data})}}))},n.onChange=function(t){var e=t.target.name,r=t.target.value,c={date:"date"===e?r:n.state.date};Object(d.d)("api/master/activity_daily",c).then((function(t){return n.setState(Object(i.a)({},t,Object(a.a)({},e,r)))}))},n.syncEvent=function(t,e){return Object(d.d)("api/master/activity_info",{op:"update",id:e||"new",user_id:n.state.user_id,type_id:t,event:"auto",date:n.state.date}).then((function(e){if(e.update){var a=n.state.data.findIndex((function(e){return e.id===t})),i=n.state.data[a];Object.assign(i,{user_id:n.state.user_id,event:"auto",act_id:e.data.id}),n.setState({data:n.state.data})}}))},n.listItem=function(t){return[t.type,t.user_id?n.state.users[t.user_id].alias:"-",t.event?t.event:"-",s.a.createElement(u.Fragment,null,!t.user_id&&s.a.createElement(m.AddButton,{key:"ad_add_"+t.id,onClick:function onClick(){return n.syncEvent(t.id,t.act_id)}}),t.user_id&&t.user_id!==parseInt(n.state.user_id)&&s.a.createElement(m.SyncButton,{key:"ad_sync_"+t.id,onClick:function onClick(){return n.syncEvent(t.id,t.act_id)}}),t.act_id&&s.a.createElement(m.InfoButton,{key:"ad_info",onClick:function onClick(){return n.changeContent(s.a.createElement(_,{key:"activity_"+t.act_id,id:t.act_id}))}}),t.act_id&&s.a.createElement(m.DeleteButton,{key:"ad_del",onClick:function onClick(){return n.deleteList(t.act_id)}}))]};var c=new Date(Date.now());return n.state={data:[],date:c.toISOString().substring(0,10),user_id:void 0,users:{}},n}return Object(c.a)(Daily,[{key:"componentDidMount",value:function componentDidMount(){var t=this;Object(d.d)("api/master/activity_daily",{extras:["users"]}).then((function(e){return t.setState(Object(i.a)({},e,{user_id:t.context.settings.id}))}))}},{key:"render",value:function render(){var t=this;return this.state.data?s.a.createElement(y.ContentReport,{key:"ad_cr",header:"Activities",thead:["Type","User","Event",""],trows:this.state.data,listItem:this.listItem},s.a.createElement(m.ReloadButton,{key:"ad_reload_btn",onClick:function onClick(){return t.componentDidMount()}}),s.a.createElement(p.SelectInput,{key:"ad_user_id",id:"user_id",label:"User",value:this.state.user_id,onChange:this.onChange},Object.values(this.state.users).map((function(t,e){return s.a.createElement("option",{key:e,value:t.id},t.alias)}))),s.a.createElement(p.DateInput,{key:"ad_date",id:"date",value:this.state.date,onChange:this.onChange})):s.a.createElement(y.Spinner,null)}}]),Daily}(u.Component);k.contextType=y.RimsContext;var C=function(t){Object(l.a)(Report,t);var e=Object(o.a)(Report);function Report(t){var n;return Object(r.a)(this,Report),(n=e.call(this,t)).listItem=function(t){return[t.date+" - "+t.time,t.user,t.type,t.class,t.event]},n.state={},n}return Object(c.a)(Report,[{key:"componentDidMount",value:function componentDidMount(){var t=this;Object(d.d)("api/master/activity_list",{group:"month",mode:"full"}).then((function(e){return t.setState(e)}))}},{key:"render",value:function render(){return s.a.createElement(y.ContentReport,{key:"act_cr",header:"Activities",thead:["Time","User","Type","Class","Event"],trows:this.state.data,listItem:this.listItem})}}]),Report}(u.Component),E=function(t){Object(l.a)(TypeList,t);var e=Object(o.a)(TypeList);function TypeList(t){var n;return Object(r.a)(this,TypeList),(n=e.call(this,t)).listItem=function(t){return[t.id,t.type,t.class,s.a.createElement(u.Fragment,null,s.a.createElement(m.ConfigureButton,{key:"act_tp_info",onClick:function onClick(){return n.changeContent(s.a.createElement(b,{key:"activity_type_"+t.id,id:t.id}))},title:"Edit type information"}),s.a.createElement(m.DeleteButton,{key:"act_tp_delete",onClick:function onClick(){return n.deleteList(t.id)},title:"Delete type"}))]},n.changeContent=function(t){return n.setState({content:t})},n.deleteList=function(t){return window.confirm("Really delete type?")&&Object(d.d)("api/master/activity_type_delete",{id:t}).then((function(e){return e.deleted&&n.setState({data:n.state.data.filter((function(e){return e.id!==t})),content:null})}))},n.state={},n}return Object(c.a)(TypeList,[{key:"componentDidMount",value:function componentDidMount(){var t=this;Object(d.d)("api/master/activity_type_list").then((function(e){return t.setState(e)}))}},{key:"render",value:function render(){var t=this;return s.a.createElement(u.Fragment,null,s.a.createElement(y.ContentList,{key:"act_tp_cl",header:"Activity Types",thead:["ID","Type","Class",""],trows:this.state.data,listItem:this.listItem},s.a.createElement(m.ReloadButton,{key:"act_tp_btn_reload",onClick:function onClick(){return t.componentDidMount()}}),s.a.createElement(m.AddButton,{key:"act_tp_btn_add",onClick:function onClick(){return t.changeContent(s.a.createElement(b,{key:"act_tp_new_"+Object(d.e)(),id:"new"}))},title:"Add activity type"})),s.a.createElement(y.ContentData,{key:"act_tp_cd"},this.state.content))}}]),TypeList}(u.Component),b=function(t){Object(l.a)(TypeInfo,t);var e=Object(o.a)(TypeInfo);function TypeInfo(t){var n;return Object(r.a)(this,TypeInfo),(n=e.call(this,t)).onChange=function(t){return n.setState({data:Object(i.a)({},n.state.data,Object(a.a)({},t.target.name,t.target.value))})},n.changeContent=function(t){return n.setState({content:t})},n.updateInfo=function(){return Object(d.d)("api/master/activity_type_info",Object(i.a)({op:"update"},n.state.data)).then((function(t){return n.setState(t)}))},n.state={data:null,content:null},n}return Object(c.a)(TypeInfo,[{key:"componentDidMount",value:function componentDidMount(){var t=this;Object(d.d)("api/master/activity_type_info",{id:this.props.id}).then((function(e){return t.setState(e)}))}},{key:"render",value:function render(){var t=this;return this.state.data?s.a.createElement(y.InfoArticle,{key:"at_art",header:"Activity Type"},s.a.createElement(y.InfoColumns,{key:"at_content"},s.a.createElement(p.TextLine,{key:"id",id:"id",text:this.state.data.id}),s.a.createElement(p.TextInput,{key:"type",id:"type",value:this.state.data.type,onChange:this.onChange,placeholder:"name"}),s.a.createElement(p.SelectInput,{key:"class",id:"class",value:this.state.data.class,onChange:this.onChange},this.state.classes.map((function(t){return s.a.createElement("option",{key:t,value:t},t)})))),s.a.createElement(m.SaveButton,{key:"at_save",onClick:function onClick(){return t.updateInfo()},title:"Save"})):s.a.createElement(y.Spinner,null)}}]),TypeInfo}(u.Component)}}]);
//# sourceMappingURL=12.8bd2140b.chunk.js.map