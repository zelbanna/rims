{"version":3,"sources":["visualize.jsx"],"names":["Main","props","changeContent","elem","setState","state","List","key","this","Component","listItem","row","id","name","onClick","Edit","changeSelf","type","title","window","open","deleteList","confirm","post_call","then","result","deleted","data","filter","header","thead","trows","componentDidMount","mountUpdate","fun","content","changeImport","dev","lib","Info","onChange","e","target","value","jsonHandler","JSON","parse","console","log","updateInfo","op","doubleClick","params","nodes","toggleEdit","edit","viz","network","setOptions","manipulation","enabled","toggleFix","forEach","node","update","fixed","get","togglePhysics","options","physics","physics_button","StopButton","StartButton","networkSync","storePositions","edges","label","showDiv","display","found","canvas","React","createRef","vis","DataSet","clickToUse","Network","current","on","PhysicsButton","text","className","styles","style","ref","stringify","undefined"],"mappings":"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","file":"static/js/3.18a42754.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport { post_call } from './infra/Functions.js';\nimport { Article, ContentData, ContentList, Result } from './infra/UI.jsx';\nimport { BackButton, DeleteButton, EditButton, FixButton, ReloadButton, SaveButton, StartButton, StopButton, TextButton, NetworkButton } from './infra/Buttons.jsx';\nimport { TextInput } from './infra/Inputs.jsx';\nimport styles from './infra/ui.module.css';\n\n// ************** Main **************\n//\nexport class Main extends Component {\n constructor(props){\n  super(props)\n  this.state = <List key='viz_list' />\n }\n\n changeContent = (elem) => this.setState(elem)\n\n render(){\n  return  <>{this.state}</>\n }\n}\n\n// ************** List **************\n//\nexport class List extends Component {\n constructor(props){\n  super(props)\n  this.state = {}\n }\n\n componentDidMount(){\n  post_call('api/visualize/list')\n   .then((result) => { this.setState(result); })\n }\n\n listItem = (row) => [row.id,row.name,<>\n  <EditButton key='edit' onClick={() => this.changeContent(<Edit key={'viz_edit_'+row.id} id={row.id} changeSelf={this.changeContent} type='map' />)} title='Show and edit map' />\n  <NetworkButton key='net' onClick={() => window.open(`viz.html?id=${row.id}`,'_blank')} title='Show resulting map' />\n  <DeleteButton key='del' onClick={() => this.deleteList(row.id)} />\n </>]\n\n deleteList = (id) => (window.confirm('Delete map?') && post_call('api/visualize/delete', {id:id}).then(result => {\n  if (result.deleted){\n   this.setState({data:this.state.data.filter(row => (row.id !== id))});\n   this.changeContent(null);\n  }}))\n\n render(){\n  return <>\n   <ContentList key='cl' header='Maps' thead={['ID','Name','']} trows={this.state.data} listItem={this.listItem}>\n    <ReloadButton key='reload' onClick={() => this.componentDidMount() } />\n   </ContentList>\n   <ContentData key='cda' mountUpdate={(fun) => this.changeContent = fun} />\n  </>\n }\n}\n\n// ************** Edit **************\n//\nexport class Edit extends Component {\n constructor(props){\n  super(props)\n  this.state = {content:'network', physics_button:StartButton, found:true, data:{name:'N/A'}, result:''}\n  this.viz = {network:null,nodes:null,edges:null}\n  this.canvas = React.createRef()\n  this.edit = false;\n }\n\n changeContent = (elem) => this.setState({content:elem})\n\n componentDidMount(){\n  import('vis-network/standalone/esm/vis-network').then(vis => {\n   post_call('api/visualize/network',{id:this.props.id,type:this.props.type}).then((result) => {\n    this.viz.nodes = new vis.DataSet(result.data.nodes);\n    this.viz.edges = new vis.DataSet(result.data.edges);\n    result.data.options.physics.enabled = true;\n    result.data.options.clickToUse = true;\n    this.viz.network = new vis.Network(this.canvas.current, {nodes:this.viz.nodes, edges:this.viz.edges}, result.data.options);\n    this.viz.network.on('stabilizationIterationsDone', () => this.viz.network.setOptions({ physics: false }))\n    this.viz.network.on('doubleClick', (params) => this.doubleClick(params))\n    this.viz.network.on('dragEnd', (params) => this.networkSync(params))\n    result.data.options.physics.enabled = false;\n    this.setState(result)\n   })\n  })\n }\n\n changeImport = (dev) => import('./device.jsx').then(lib => this.props.changeSelf(<lib.Info key={'di_'+dev} id={dev} />));\n\n onChange = (e) => this.setState({data:{...this.state.data, [e.target.name]:e.target.value}});\n\n jsonHandler = (e) => {\n  var data = {...this.state.data}\n  try {\n   data[e.target.name] = JSON.parse(e.target.value);\n   this.setState({data:data})\n  } catch {\n   console.log('Error converting string to JSON')\n  }\n }\n\n updateInfo = () => post_call('api/visualize/network',{op:'update', ...this.state.data}).then(result => this.setState(result))\n\n doubleClick = (params) => {\n  console.log('DoubleClick',params.nodes[0]);\n  this.props.changeSelf && this.changeImport(params.nodes[0]);\n }\n\n toggleEdit = () => {\n  this.edit = !this.edit;\n  this.viz.network.setOptions({ manipulation:{ enabled:this.edit }})\n  this.setState({result:'Edit:'+this.edit});\n }\n\n toggleFix = () => {\n  this.viz.nodes.forEach((node,id) => this.viz.nodes.update({id:id,fixed:!(node.fixed)}) );\n  this.setState({data:{...this.state.data, nodes:this.viz.nodes.get()}, result:'Fix/Unfix positions'})\n }\n\n togglePhysics = () => {\n  const data = this.state.data;\n  data.options.physics.enabled = !data.options.physics.enabled;\n  this.viz.network.setOptions({ physics:data.options.physics.enabled })\n  this.setState({data:data, physics_button:(data.options.physics.enabled) ? StopButton:StartButton, result:'Physics:'+data.options.physics.enabled})\n }\n\n networkSync = (params) => {\n  this.viz.network.storePositions();\n  this.setState({data:{...this.state.data, nodes:this.viz.nodes.get(), edges:this.viz.edges.get()}, result:'Moved ' + this.viz.nodes.get(params.nodes[0]).label})\n }\n\n showDiv = (id) => (id === this.state.content) ? {display:'block'} : {display:'none'}\n\n render(){\n  const PhysicsButton = this.state.physics_button;\n  return(\n   <Article key='viz_art' header='Network Map'>\n    {(this.props.type === 'device') && (this.props.changeSelf) && <BackButton key='viz_back' onClick={() => this.changeImport(this.props.id)} />}\n    <ReloadButton key='viz_reload' onClick={() => this.componentDidMount()} />\n    <EditButton key='viz_edit' onClick={() => this.toggleEdit()} />\n    <PhysicsButton key='viz_physics' onClick={() => this.togglePhysics()} />\n    <FixButton key='viz_fix' onClick={() => this.toggleFix()} />\n    <SaveButton key='viz_save' onClick={() => this.updateInfo()} />\n    <NetworkButton key='viz_net' onClick={() => this.changeContent('network')} />\n    <TextButton key='viz_opt' text='Options' onClick={() => this.changeContent('options')} />\n    <TextButton key='viz_nodes' text='Nodes' onClick={() => this.changeContent('nodes')} />\n    <TextButton key='viz_edges' text='Edges' onClick={() => this.changeContent('edges')} />\n    <TextInput key='viz_name' id='name' value={this.state.data.name} onChange={this.onChange} />\n    <Result key='viz_result' result={this.state.result} />\n    <div className={styles.network} style={this.showDiv('network')} ref={this.canvas} />\n    <div className={styles.network} style={this.showDiv('options')}><textarea id='options' name='options' value={JSON.stringify(this.state.data.options,undefined,2)} onChange={this.jsonHandler}/></div>\n    <div className={styles.network} style={this.showDiv('nodes')}><textarea id='nodes' name='nodes' value={JSON.stringify(this.state.data.nodes,undefined,2)} onChange={this.jsonHandler} /></div>\n    <div className={styles.network} style={this.showDiv('edges')}><textarea id='edges' name='edges' value={JSON.stringify(this.state.data.edges,undefined,2)} onChange={this.jsonHandler} /></div>\n   </Article>\n  )\n }\n}\n"],"sourceRoot":""}