"use strict";(self.webpackChunkrims_frontend=self.webpackChunkrims_frontend||[]).push([[790],{790:(t,e,s)=>{s.r(e),s.d(e,{List:()=>l,LogShow:()=>m,TaskShow:()=>C});var n=s(43),o=s(524),i=s(662),a=s(307),d=s(97),r=s(728),h=s(579);class l extends n.Component{constructor(t){super(t),this.listItem=t=>[t.node,t.url,(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(r.InfoButton,{onClick:()=>this.changeContent((0,h.jsx)(c,{id:t.id},"node_info")),title:"Node information"},"info"),(0,h.jsx)(r.DeleteButton,{onClick:()=>this.deleteList(t.id),title:"Delete node"},"del")]})],this.deleteList=t=>window.confirm("Really delete node?")&&(0,o.Cc)("api/master/node_delete",{id:t}).then(e=>{e.deleted&&(this.setState({data:this.state.data.filter(e=>e.id!==t)}),this.changeContent(null))}),this.state={}}componentDidMount(){(0,o.Cc)("api/master/node_list").then(t=>this.setState(t))}render(){return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(i.ContentList,{header:"Nodes",thead:["Node","URL",""],trows:this.state.data,listItem:this.listItem,children:[(0,h.jsx)(r.ReloadButton,{onClick:()=>this.componentDidMount()},"reload"),(0,h.jsx)(r.AddButton,{onClick:()=>this.changeContent((0,h.jsx)(c,{id:"new"},"node_info")),title:"Add node"},"add")]},"cl"),(0,h.jsx)(i.ContentData,{mountUpdate:t=>this.changeContent=t},"cda")]})}}class c extends n.Component{constructor(t){super(t),this.searchInfo=()=>(0,o.Cc)("api/device/search",{node:this.state.data.node}).then(t=>t.found&&this.setState({data:{...this.state.data,hostname:t.data.hostname,device_id:t.data.id}})),this.onChange=t=>this.setState({data:{...this.state.data,[t.target.name]:t.target.value}}),this.changeContent=t=>this.setState({content:t}),this.updateInfo=()=>(0,o.Cc)("api/master/node_info",{op:"update",...this.state.data}).then(t=>this.setState(t)),this.state={data:null,found:!0}}componentDidUpdate(t){t!==this.props&&this.componentDidMount()}componentDidMount(){(0,o.Cc)("api/master/node_info",{id:this.props.id}).then(t=>this.setState({...t,content:null}))}render(){if(this.state.found){if(this.state.data){const t=this.state.data.id,e="new"!==t;return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(i.InfoArticle,{header:"Node",children:[(0,h.jsxs)(i.InfoColumns,{children:[(0,h.jsx)(d.TextInput,{id:"node",value:this.state.data.node,onChange:this.onChange},"node"),(0,h.jsx)(d.UrlInput,{id:"url",value:this.state.data.url,onChange:this.onChange},"url"),(0,h.jsx)(d.TextInput,{id:"hostname",value:this.state.data.hostname,onChange:this.onChange},"hostname")]},"ic"),(0,h.jsx)(r.SaveButton,{onClick:()=>this.updateInfo(),title:"Save information"},"save"),e&&!this.state.data.hostname&&(0,h.jsx)(r.SearchButton,{onClick:this.searchInfo,title:"Try to map node to device"},"search"),e&&(0,h.jsx)(r.ReloadButton,{onClick:()=>this.changeContent((0,h.jsx)(u,{node:this.state.data.node},"node_reload_"+t))},"reload"),e&&(0,h.jsx)(r.LogButton,{onClick:()=>this.changeContent((0,h.jsx)(m,{node:this.state.data.node},"node_logs_"+t)),title:"View node logs"},"logs"),e&&(0,h.jsx)(r.DeleteButton,{onClick:()=>this.changeContent((0,h.jsx)(p,{node:this.state.data.node},"node_logc_"+t)),title:"Clear logs"},"logc"),e&&(0,h.jsx)(r.TimeButton,{onClick:()=>this.changeContent((0,h.jsx)(C,{node:this.state.data.node},"node_tasks_"+t)),title:"View node tasks"},"tasks")]},"ia_node"),(0,h.jsx)(a.NavBar,{id:"node_navigation"},"node_navigation"),this.state.content]})}return(0,h.jsx)(i.Spinner,{})}return(0,h.jsxs)(i.InfoArticle,{children:["Node with id: ",this.props.id," removed"]},"ia_node")}}class u extends n.Component{componentDidMount(){(0,o.Cc)("api/system/reload",{},{"X-Route":this.props.node}).then(t=>{t?this.setState(t):this.setState({modules:["error reloading modules (check REST call)"]})})}render(){return this.state?(0,h.jsx)(i.CodeArticle,{header:"Module",children:this.state.modules.join("\n")},"nr_code"):(0,h.jsx)(i.Spinner,{})}}class p extends n.Component{componentDidMount(){(0,o.Cc)("api/system/logs_clear",{},{"X-Route":this.props.node}).then(t=>this.setState({logs:t.file}))}render(){return this.state?(0,h.jsx)(i.CodeArticle,{header:"Cleared",children:Object.entries(this.state.logs).map(t=>`${t[0]}: ${t[1]}`).join("\n")},"nc_code"):(0,h.jsx)(i.Spinner,{})}}class m extends n.Component{constructor(t){super(t),this.state={}}componentDidMount(){(0,o.Cc)("api/system/logs_get",{},{"X-Route":this.props.node}).then(t=>{const e=t?{logs:t}:{error:!0};this.setState(e)})}render(){return this.state.logs?(0,h.jsx)("div",{children:Object.entries(this.state.logs).map((t,e)=>(0,h.jsx)(i.CodeArticle,{header:t[0],children:t[1].join("\n")},e))}):this.state.error?(0,h.jsx)(i.CodeArticle,{children:"error retrieving logs (check REST call)"}):(0,h.jsx)(i.Spinner,{})}}class C extends n.Component{constructor(t){super(t),this.listItem=t=>[t.module,t.function,t.frequency,JSON.stringify(t.output),JSON.stringify(t.args)],this.state={}}componentDidMount(){(0,o.Cc)("api/system/task_list",{},{"X-Route":this.props.node}).then(t=>{const e=t?{tasks:t}:{error:!0};this.setState(e)})}render(){return this.state.tasks?(0,h.jsx)(i.ContentReport,{header:"Tasks",thead:["Module","Function","Frequency","Output","Arguments"],trows:this.state.tasks.data,listItem:this.listItem},"cr_task_show"):this.state.error?(0,h.jsx)(i.CodeArticle,{children:"error retrieving tasks (check REST call)"}):(0,h.jsx)(i.Spinner,{})}}}}]);
//# sourceMappingURL=790.578112d2.chunk.js.map