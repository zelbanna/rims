(this.webpackJsonprims=this.webpackJsonprims||[]).push([[15],{44:function(t,e,n){"use strict";n.r(e),n.d(e,"Main",(function(){return b})),n.d(e,"Manage",(function(){return _})),n.d(e,"Inventory",(function(){return m}));var i=n(19),a=n(10),s=n(5),c=n(6),o=n(8),r=n(7),d=n(3),u=n(14),p=n(15),h=n(21),j=n(16),v=n(17),l=n(35),f=n(0),b=function(t){Object(o.a)(n,t);var e=Object(r.a)(n);function n(t){var i;return Object(s.a)(this,n),(i=e.call(this,t)).listItem=function(t){var e="up"===t.ip_state;return[t.hostname,t.type_name,Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(p.StateLeds,{state:t.ip_state},"state"),e&&"manage"===t.type_functions&&Object(f.jsx)(h.InfoButton,{onClick:function(){return i.context.changeMain(Object(f.jsx)(_,{device_id:t.id,type:t.type_name},"hypervisor_manage_"+t.id))}},"info"),e&&t.url&&t.url.length>0&&Object(f.jsx)(h.UiButton,{onClick:function(){return window.open(t.url,"_blank")}},"ui")]})]},i.state={},i}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var t=this;Object(u.d)("api/device/list",{field:"base",search:"hypervisor",extra:["type","functions","url"],sort:"hostname"}).then((function(e){return t.setState(e)}))}},{key:"render",value:function(){var t=this;return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(p.ContentList,{header:"Hypervisor",thead:["Hostname","Type",""],trows:this.state.data,listItem:this.listItem,children:Object(f.jsx)(h.SyncButton,{onClick:function(){return t.changeContent(Object(f.jsx)(O,{},"vm_sync"))}},"sync")},"cl"),Object(f.jsx)(p.ContentData,{mountUpdate:function(e){return t.changeContent=e}},"cda")]})}}]),n}(d.Component);b.contextType=p.RimsContext;var O=function(t){Object(o.a)(n,t);var e=Object(r.a)(n);function n(t){var i;return Object(s.a)(this,n),(i=e.call(this,t)).listItem=function(t){return[t.type,t.host_id,t.device_id,t.vm,t.device_uuid,t.config]},i.state={},i}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var t=this;Object(u.d)("api/device/vm_mapping",{device_id:this.props.device_id}).then((function(e){var n=[];["existing","inventory","discovered","database"].forEach((function(t){e.hasOwnProperty(t)&&e[t].forEach((function(e){e.type=t,n.push(e)}))})),t.setState({data:n})}))}},{key:"render",value:function(){return Object(f.jsx)(p.ContentReport,{header:"VM Mapping",thead:["Status","Host","Device","VM Name","Device UUID","Config"],trows:this.state.data,listItem:this.listItem},"hyp_cr")}}]),n}(d.Component),_=function(t){Object(o.a)(n,t);var e=Object(r.a)(n);function n(t){var i;return Object(s.a)(this,n),(i=e.call(this,t)).changeContent=function(t){return i.setState({content:t})},i.state={},i}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var t=this;Object(u.d)("api/device/management",{id:this.props.device_id}).then((function(e){t.context.loadNavigation(Object(f.jsxs)(v.NavBar,{children:[Object(f.jsx)(v.NavButton,{title:"Inventory",onClick:function(){return t.changeContent(Object(f.jsx)(m,{device_id:t.props.device_id,type:t.props.type},"hypervisor_inventory"))}},"hyp_nav_inv"),Object(f.jsx)(v.NavButton,{title:"Logs",onClick:function(){return t.changeContent(Object(f.jsx)(l.Logs,{id:t.props.device_id},"device_logs"))}},"hyp_nav_logs"),e.data.url&&e.data.url.length>0&&Object(f.jsx)(v.NavButton,{title:"UI",onClick:function(){return window.open(e.data.url,"_blank")}},"hyp_nav_ui"),Object(f.jsx)(v.NavInfo,{title:e.data.hostname},"hyp_nav_name")]},"hypervisor_navbar")),t.setState(Object(a.a)(Object(a.a)({},e),{},{content:Object(f.jsx)(m,{device_id:t.props.device_id,type:t.props.type},"hypervisor_inventory")}))}))}},{key:"render",value:function(){return Object(f.jsx)(f.Fragment,{children:this.state.content})}}]),n}(d.Component);_.contextType=p.RimsContext;var m=function(t){Object(o.a)(n,t);var e=Object(r.a)(n);function n(t){var i;return Object(s.a)(this,n),(i=e.call(this,t)).sortList=function(t){var e=i.state.data;"name"===t?e.sort((function(t,e){return t.name.localeCompare(e.name)})):e.sort((function(t,e){return t.id-e.id})),i.setState({sort:t})},i.listItem=function(t){return[t.id,t.name,Object(f.jsx)(x,{vm_id:t.id,device_id:i.props.device_id,type:i.props.type,changeContent:function(t){return i.changeContent(t)},state:t.state},"hl_op_"+t.id)]},i.state={sort:"name",searchfield:""},i}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var t=this;Object(u.d)("api/devices/"+this.props.type+"/inventory",{device_id:this.props.device_id,sort:this.state.sort}).then((function(e){return t.setState(e)}))}},{key:"render",value:function(){var t=this;if(this.state.data){var e=this.state.searchfield,n=0===e.length?this.state.data:this.state.data.filter((function(t){return t.name.toLowerCase().includes(e)})),i=[Object(f.jsx)(h.HeaderButton,{text:"ID",highlight:"id"===this.state.sort,onClick:function(){return t.sortList("id")}},"id"),Object(f.jsx)(h.HeaderButton,{text:"VM",highlight:"name"===this.state.sort,onClick:function(){return t.sortList("name")}},"vm"),"Operations"];return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)(p.ContentList,{header:"Inventory",thead:i,trows:n,listItem:this.listItem,children:[Object(f.jsx)(h.ReloadButton,{onClick:function(){t.setState({data:void 0}),t.componentDidMount()}},"reload"),Object(f.jsx)(h.LogButton,{onClick:function(){return t.changeContent(Object(f.jsx)(l.Logs,{id:t.props.device_id},"device_logs"))},title:"Device logs"},"logs"),Object(f.jsx)(h.SyncButton,{onClick:function(){return t.changeContent(Object(f.jsx)(O,{device_id:t.props.device_id},"vm_sync"))},title:"Map VMs"},"sync"),Object(f.jsx)(j.SearchField,{searchFire:function(e){return t.setState({searchfield:e})},placeholder:"Search inventory"},"search")]},"cl"),Object(f.jsx)(p.ContentData,{mountUpdate:function(e){return t.changeContent=e}},"cda")]})}return Object(f.jsx)(p.Spinner,{})}}]),n}(d.Component),x=function(t){Object(o.a)(n,t);var e=Object(r.a)(n);function n(t){var i;return Object(s.a)(this,n),(i=e.call(this,t)).operation=function(t){i.setState({wait:Object(f.jsx)(p.Spinner,{})}),Object(u.d)("api/devices/"+i.props.type+"/vm_op",{device_id:i.props.device_id,vm_id:i.props.vm_id,op:t}).then((function(t){return i.setState(Object(a.a)(Object(a.a)({},t),{},{wait:null}))}))},i.snapshot=function(t){i.setState({wait:Object(f.jsx)(p.Spinner,{})}),Object(u.d)("api/devices/"+i.props.type+"/vm_snapshot",{device_id:i.props.device_id,vm_id:i.props.vm_id,op:t}).then((function(t){return i.setState(Object(a.a)(Object(a.a)({},t),{},{wait:null}))}))},i.state={state:i.props.state,status:"",wait:null},i}return Object(c.a)(n,[{key:"render",value:function(){var t=this,e="on"===this.state.state,n="off"===this.state.state;return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(h.InfoButton,{onClick:function(){return t.props.changeContent(Object(f.jsx)(y,{device_id:t.props.device_id,vm_id:t.props.vm_id,type:t.props.type,changeSelf:t.props.changeContent},"hypervisor_info"))},title:"VM info"},"info"),(n||"suspended"===this.state.state)&&Object(f.jsx)(h.StartButton,{onClick:function(){return t.operation("on")},title:this.state.status},"start"),e&&Object(f.jsx)(h.StopButton,{onClick:function(){return t.operation("shutdown")},title:this.state.status},"stop"),e&&Object(f.jsx)(h.ReloadButton,{onClick:function(){return t.operation("reboot")},title:this.state.status},"reload"),e&&Object(f.jsx)(h.PauseButton,{onClick:function(){return t.operation("suspend")},title:this.state.status},"suspend"),(e||"suspended"===this.state.state)&&Object(f.jsx)(h.ShutdownButton,{onClick:function(){return t.operation("off")},title:this.state.status},"shutdown"),n&&Object(f.jsx)(h.SnapshotButton,{onClick:function(){return t.snapshot("create")},title:"Take snapshot"},"snapshot"),n&&Object(f.jsx)(h.ItemsButton,{onClick:function(){return t.props.changeContent(Object(f.jsx)(g,{device_id:t.props.device_id,vm_id:t.props.vm_id,type:t.props.type},"hypervisor_snapshots_"+t.props.vm_id))},title:"Snapshot info"},"snapshots"),this.state.wait]})}}]),n}(d.Component),y=function(t){Object(o.a)(b,t);var e=Object(r.a)(b);function b(t){var c;return Object(s.a)(this,b),(c=e.call(this,t)).onChange=function(t){return c.setState({data:Object(a.a)(Object(a.a)({},c.state.data),{},Object(i.a)({},t.target.name,t.target.value))})},c.changeSelf=function(t){return c.props.changeSelf(t)},c.changeContent=function(t){return c.setState({content:t})},c.changeImport=function(t){return n.e(1).then(n.bind(null,36)).then((function(e){return c.setState({content:Object(f.jsx)(e.Info,{device_id:c.state.data.device_id,class:"virtual",mac:t.mac,name:t.name,interface_id:t.interface_id,description:t.port,changeSelf:c.changeContent},"interface_info")})}))},c.state={},c}return Object(c.a)(b,[{key:"componentDidUpdate",value:function(t){t!==this.props&&this.componentDidMount()}},{key:"componentDidMount",value:function(){var t=this;Object(u.d)("api/devices/"+this.props.type+"/vm_info",{device_id:this.props.device_id,vm_id:this.props.vm_id}).then((function(e){null===e.data.device_id&&(e.data.device_id=""),t.setState(e)}))}},{key:"syncDatabase",value:function(){var t=this;Object(u.d)("api/devices/"+this.props.type+"/vm_info",{device_id:this.props.device_id,vm_id:this.props.vm_id,op:"update"}).then((function(e){return t.setState(e)}))}},{key:"updateInfo",value:function(){var t=this;Object(u.d)("api/devices/"+this.props.type+"/vm_map",{device_uuid:this.state.data.device_uuid,device_id:this.state.data.device_id,host_id:this.props.device_id,op:"update"}).then((function(e){return t.setState({update:e.update})}))}},{key:"interfaceButton",value:function(t,e){var n=this;return this.state.data.device_id?e.interface_id?Object(f.jsx)(h.InfoButton,{onClick:function(){return n.changeImport({interface_id:e.interface_id})}},"info"):Object(f.jsx)(h.AddButton,{onClick:function(){return n.changeImport(Object(a.a)(Object(a.a)({},e),{},{interface_id:"new"}))}},"add"):Object(f.jsx)("div",{})}},{key:"render",value:function(){var t=this;if(this.state.data){var e=this.state.data;return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)(p.InfoArticle,{header:"VM info",children:[Object(f.jsxs)(p.InfoColumns,{columns:3,children:[Object(f.jsx)(j.TextLine,{id:"name",text:e.name},"name"),Object(f.jsx)("div",{}),Object(f.jsx)(j.TextInput,{id:"device_id",label:"Device ID",value:e.device_id,onChange:this.onChange},"device_id"),Object(f.jsx)("div",{}),Object(f.jsx)(j.TextLine,{id:"device",label:"Device Name",text:e.device_name},"device_name"),Object(f.jsx)("div",{}),Object(f.jsx)(j.TextLine,{id:"snmp_id",label:"SNMP id",text:e.snmp_id},"snmp"),Object(f.jsx)("div",{}),Object(f.jsx)(j.TextLine,{id:"uuid",label:"UUID",text:e.device_uuid},"uuid"),Object(f.jsx)("div",{}),Object(f.jsx)(j.StateLine,{id:"state",state:e.state},"state"),Object(f.jsx)("div",{}),Object(f.jsx)(j.TextLine,{id:"config",text:e.config},"config"),Object(f.jsx)("div",{}),Object.entries(this.state.interfaces).map((function(e){return Object(f.jsxs)(d.Fragment,{children:[Object(f.jsx)(j.TextLine,{id:"interface_"+e[0],label:"Interface",text:"".concat(e[1].name," - ").concat(e[1].mac," - ").concat(e[1].port)},"interface"),t.interfaceButton(e[0],e[1])]},e[0])}))]},"hyp_ic"),Object(f.jsx)(h.ReloadButton,{onClick:function(){return t.componentDidMount()},title:"Reload"},"reload"),Object(f.jsx)(h.SaveButton,{onClick:function(){return t.updateInfo()},title:"Save mapping"},"save"),Object(f.jsx)(h.SyncButton,{onClick:function(){return t.syncDatabase()},title:"Resync database with VM info"},"sync"),e.device_id&&Object(f.jsx)(h.GoButton,{onClick:function(){return t.changeSelf(Object(f.jsx)(l.Info,{id:e.device_id,changeSelf:t.props.changeSelf},"device_info"))},title:"VM device info"},"go"),Object(f.jsx)(p.Result,{result:JSON.stringify(this.state.update)},"result")]},"hyp_article"),Object(f.jsx)(v.NavBar,{}),this.state.content]})}return Object(f.jsx)(p.Spinner,{})}}]),b}(d.Component),g=function(t){Object(o.a)(n,t);var e=Object(r.a)(n);function n(t){var i;return Object(s.a)(this,n),(i=e.call(this,t)).snapshot=function(t,e){i.setState({wait:Object(f.jsx)(p.Spinner,{})}),Object(u.d)("api/devices/"+i.props.type+"/vm_snapshot",{device_id:i.props.device_id,vm_id:i.props.vm_id,op:t,snapshot:e}).then((function(t){return i.setState(Object(a.a)(Object(a.a)({},t),{},{wait:null}))}))},i.deleteList=function(t){window.confirm("Really delete snapshot?")&&(i.setState({wait:Object(f.jsx)(p.Spinner,{})}),Object(u.d)("api/devices/"+i.props.type+"/vm_snapshot",{device_id:i.props.device_id,vm_id:i.props.vm_id,op:"remove",snapshot:t}).then((function(e){if(e.deleted){var n=0,a=i.state.data.filter((function(e){return e.id!==t}));a.forEach((function(t){n=n<parseInt(t.id)?parseInt(t.id):n})),i.setState({data:a,highest:n,wait:null})}})))},i.listItem=function(t){return[t.name,t.id,t.desc,t.created,t.state,Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(h.RevertButton,{onClick:function(){return i.snapshot("revert",t.id)},title:"Revert to snapshot"},"revert"),Object(f.jsx)(h.DeleteButton,{onClick:function(){return i.deleteList(t.id)},title:"Delete snapshot"},"del")]})]},i.state={},i}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.snapshot("list",void 0)}},{key:"render",value:function(){var t=this;return Object(f.jsxs)(p.ContentReport,{header:"Snapshot (".concat(this.props.vm_id,") Highest ID:").concat(this.state.highest),thead:["Name","ID","Description","Created","State",""],trows:this.state.data,listItem:this.listItem,children:[Object(f.jsx)(h.ReloadButton,{onClick:function(){return t.snapshot("list",void 0)},title:"Reload list"},"reload"),this.state.wait]},"hyp_snapshot_cr")}}]),n}(d.Component)}}]);
//# sourceMappingURL=15.1d19e0d3.chunk.js.map